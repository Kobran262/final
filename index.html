<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ä–µƒß–∞ 2024 - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f8f9fa, #e9ecef); min-height: 100vh; padding: 20px; color: #212529; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); overflow: hidden; border: 2px solid #dee2e6; }
        .header { background: linear-gradient(135deg, #212529, #343a40); color: white; padding: 30px; display: flex; align-items: center; gap: 20px; }
        .header h1 { font-size: 32px; margin-bottom: 10px; font-weight: 700; }
        .header p { opacity: 0.9; font-size: 16px; }
        .logo { width: 80px; height: 80px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: #212529; }
        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 3px solid #dee2e6; }
        .nav-tab { flex: 1; padding: 20px; text-align: center; background: none; border: none; cursor: pointer; font-size: 16px; font-weight: 600; color: #495057; transition: all 0.3s ease; }
        .nav-tab.active { background: white; color: #212529; border-bottom: 3px solid #212529; }
        .nav-tab:hover:not(.active) { background: #e9ecef; }
        .tab-content { display: none; padding: 30px; min-height: 600px; }
        .tab-content.active { display: block; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #212529; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 14px; transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #212529; box-shadow: 0 0 0 3px rgba(33, 37, 41, 0.1); }
        .btn { padding: 12px 24px; border: 2px solid transparent; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-right: 10px; margin-bottom: 10px; text-transform: uppercase; }
        .btn-primary { background: #212529; color: white; border-color: #212529; }
        .btn-primary:hover { background: #343a40; }
        .btn-success { background: #6c757d; color: white; border-color: #6c757d; }
        .btn-success:hover { background: #5a6268; }
        .btn-danger { background: white; color: #212529; border-color: #212529; }
        .btn-danger:hover { background: #212529; color: white; }
        .btn-secondary { background: white; color: #6c757d; border-color: #6c757d; }
        .btn-secondary:hover { background: #6c757d; color: white; }
        .table-container { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-top: 20px; max-height: 400px; overflow-y: auto; }
        .table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        .table th { background: #212529; color: white; padding: 15px 10px; text-align: left; font-weight: 600; }
        .table td { padding: 12px 10px; border-bottom: 1px solid #dee2e6; }
        .table tr:hover { background: #f8f9fa; }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #212529, #343a40); color: white; padding: 25px; border-radius: 12px; text-align: center; }
        .stat-number { font-size: 32px; font-weight: bold; margin-bottom: 8px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        .chart-container { background: white; border-radius: 12px; padding: 25px; margin-bottom: 30px; border: 2px solid #e9ecef; }
        .chart-title { font-size: 20px; font-weight: bold; color: #212529; margin-bottom: 20px; text-align: center; }
        .filter-section { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #e9ecef; }
        .invoice-list { background: white; border-radius: 12px; padding: 20px; margin-top: 20px; border: 2px solid #e9ecef; }
        .invoice-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e9ecef; transition: background 0.3s ease; }
        .invoice-item:hover { background: #f8f9fa; }
        .invoice-item:last-child { border-bottom: none; }
        .invoice-info { flex: 1; }
        .invoice-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .invoice-status { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; background: #212529; color: white; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid; position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; }
        .alert-success { background: #f8f9fa; color: #212529; border-color: #6c757d; }
        .alert-danger { background: #f8f9fa; color: #212529; border-color: #212529; }
        .section-card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; border: 2px solid #e9ecef; }
        .company-info { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 30px; border: 2px solid #e9ecef; }
        .invoice-items { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 15px; align-items: end; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px; }
        .delivery-items { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: end; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px; }
        .totals { margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 8px; border: 2px solid #dee2e6; }
        .totals-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px; }
        .totals-final { display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; color: #212529; margin-top: 15px; padding-top: 15px; border-top: 2px solid #212529; }
        .preview { background: white; border: 2px solid #dee2e6; border-radius: 12px; padding: 30px; margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .searchable-select {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .searchable-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .searchable-input:focus {
            outline: none;
            border-color: #212529;
            box-shadow: 0 0 0 3px rgba(33, 37, 41, 0.1);
        }
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        .dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
            font-size: 14px;
        }
        .dropdown-item:hover {
            background: #f8f9fa;
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .dropdown-item.selected {
            background: #212529;
            color: white;
        }
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            padding: 40px;
            max-width: 400px;
            width: 100%;
            border: 2px solid #dee2e6;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #212529, #343a40);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        .login-form h2 {
            text-align: center;
            color: #212529;
            margin-bottom: 25px;
        }
        .login-error {
            color: #dc3545;
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #212529;
            margin: 0;
        }
        .close {
            background: none;
            border: none;
            font-size: 30px;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        .close:hover {
            background: #f8f9fa;
            color: #212529;
        }
        @media (max-width: 768px) {
            .nav-tabs { flex-direction: column; }
            .nav-tab { min-width: 100%; }
            .form-grid { grid-template-columns: 1fr; }
            .invoice-items { grid-template-columns: 1fr; }
            .delivery-items { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="loginForm" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">–°–†</div>
                <h1>–°—Ä–µƒß–∞ 2024</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</p>
            </div>
            <div class="login-form">
                <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="btn btn-primary" onclick="authenticate()">–í–æ–π—Ç–∏</button>
                <div id="loginError" class="login-error" style="display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
            </div>
        </div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="header">
            <img src="https://i.ibb.co/tMCT4jb7/srb-white-verical.png" alt="srb-white-verical" border="0" style="width: 80px; height: auto; border-radius: 12px;">
            <div>
                <h1>–°—Ä–µƒß–∞ 2024 –î–û–û</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞–º–∏ –∏ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞–º–∏</p>
                <p style="font-size: 14px; opacity: 0.8;">–ë–µ–æ–≥—Ä–∞–¥, –°—Ç–∞—Ä–∏ –ì—Ä–∞–¥, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35 | –ú–ë: 22019309 | –ü–ò–ë: 114407658</p>
            </div>
            <div style="margin-left: auto;">
                <button class="btn btn-secondary" onclick="openAddUserModal()" style="background: rgba(255,255,255,0.2); color: white; border-color: rgba(255,255,255,0.3);">
                    <span style="font-size: 16px; margin-right: 5px;">üë§</span>
                    –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('clients')">–ö–ª–∏–µ–Ω—Ç—ã</button>
            <button class="nav-tab" onclick="showTab('products')">–¢–æ–≤–∞—Ä—ã</button>
            <button class="nav-tab" onclick="showTab('invoice')">–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å</button>
            <button class="nav-tab" onclick="showTab('delivery')">–°–æ–∑–¥–∞—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É</button>
            <button class="nav-tab" onclick="showTab('statistics')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</button>
            <button class="nav-tab" onclick="showTab('logs')">–õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</button>
        </div>

        <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
        <div id="clients" class="tab-content active">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏</h2>
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                        <input type="text" id="clientName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
                    </div>
                    <div class="form-group">
                        <label>–ú–∞—Ç–∏—á–Ω–∏ –±—Ä–æ—ò *</label>
                        <input type="text" id="clientMB" placeholder="–ú–∞—Ç–∏—á–Ω–∏ –±—Ä–æ—ò">
                    </div>
                    <div class="form-group">
                        <label>–ü–ò–ë *</label>
                        <input type="text" id="clientPIB" placeholder="–ü–ò–ë">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="manualAddressInput" style="width: auto;">
                            –í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é
                        </label>
                    </div>
                    
                    <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞ -->
                    <div id="automaticAddressSection">
                        <div class="form-group">
                            <label>–ì–æ—Ä–æ–¥ *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input" id="clientCity" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." autocomplete="off">
                                <div class="dropdown-menu" id="clientCityDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–û–±—â–∏–Ω–∞ *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input" id="clientMunicipality" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≥–æ—Ä–æ–¥..." autocomplete="off" disabled>
                                <div class="dropdown-menu" id="clientMunicipalityDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–£–ª–∏—Ü–∞ *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input" id="clientStreet" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–Ω—É..." autocomplete="off" disabled>
                                <div class="dropdown-menu" id="clientStreetDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–ù–æ–º–µ—Ä –¥–æ–º–∞</label>
                            <input type="text" id="clientHouseNumber" placeholder="–ù–æ–º–µ—Ä –¥–æ–º–∞">
                        </div>
                    </div>
                    
                    <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞ -->
                    <div id="manualAddressSection" style="display: none;">
                        <div class="form-group">
                            <label>–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å *</label>
                            <textarea id="clientManualAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: Beograd, Stari grad, Knez Mihailova 5)" rows="3" style="resize: vertical;"></textarea>
                            <small style="color: #666; font-size: 12px;">–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–Ω—Ç–∞–∫—Ç</label>
                        <input type="text" id="clientContact" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω, email">
                    </div>
                    <div class="form-group">
                        <label>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç</label>
                        <input type="text" id="clientBank" placeholder="–ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞">
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="addClient()">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            <button class="btn btn-secondary" onclick="clearClientForm()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ú–ë</th><th>–ü–ò–ë</th><th>–ê–¥—Ä–µ—Å</th><th>–ö–æ–Ω—Ç–∞–∫—Ç</th><th>–ë–∞–Ω–∫</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
                    </thead>
                    <tbody id="clientsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- –¢–æ–≤–∞—Ä—ã -->
        <div id="products" class="tab-content">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
            <div class="form-grid">
                <div>
                    <div class="form-group">
                        <label>–ö–æ–¥ —Ç–æ–≤–∞—Ä–∞ *</label>
                        <input type="text" id="productCode" placeholder="GF-B-TG210">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                        <input type="text" id="productName" placeholder="Tieguanyin/Zeleni ƒåaj 210g">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –ù–î–° (RSD) *</label>
                        <input type="number" id="productPrice" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="productCategory">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="Zeleni ƒåaj">–ó–µ–ª–µ–Ω—ã–π —á–∞–π</option>
                            <option value="Crni ƒåaj">–ß–µ—Ä–Ω—ã–π —á–∞–π</option>
                            <option value="Printing">–ü–æ–ª–∏–≥—Ä–∞—Ñ–∏—è</option>
                            <option value="Other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            <button class="btn btn-secondary" onclick="clearProductForm()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr><th>–ö–æ–¥</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞ (RSD)</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
                    </thead>
                    <tbody id="productsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å -->
        <div id="invoice" class="tab-content">
            <h2>–°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å</h2>
            
            <div class="company-info">
                <h3>–ü–æ—Å—Ç–∞–≤—â–∏–∫</h3>
                <p><strong>–°—Ä–µƒß–∞ 2024 –î–û–û –ë–µ–æ–≥—Ä–∞–¥ (–°—Ç–∞—Ä–∏ –ì—Ä–∞–¥)</strong></p>
                <p>–ú–∞—Ç–∏—á–Ω–∏ –±—Ä–æ—ò: 22019309 | –ü–ò–ë: 114407658</p>
                <p>–°–µ–¥–∏—à—Ç–µ: –ë–µ–æ–≥—Ä–∞–¥, –°—Ç–∞—Ä–∏ –ì—Ä–∞–¥, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35</p>
                <p>–†–∞—á—É–Ω: 190-0000000085540-29 (Alta Banka)</p>
            </div>

            <div class="section-card">
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ù–æ–º–µ—Ä –∏–Ω–≤–æ–π—Å–∞ *</label>
                        <input type="text" id="invoiceNumber" placeholder="1-DDMMYYYY">
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ *</label>
                        <input type="date" id="invoiceDate">
                    </div>
                    <div class="form-group">
                        <label>–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã *</label>
                        <input type="date" id="invoiceDueDate">
                    </div>
                    <div class="form-group">
                        <label>–ö–ª–∏–µ–Ω—Ç *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input" id="invoiceClientSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞..." autocomplete="off">
                            <input type="hidden" id="invoiceClient" value="">
                            <div class="dropdown-menu" id="invoiceClientDropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <select id="invoiceDelivery">
                            <option value="—Å–æ–ø—Å—Ç–≤–µ–Ω–∏ –ø—Ä–µ–≤–æ–∑">–°–æ–ø—Å—Ç–≤–µ–Ω–∏ –ø—Ä–µ–≤–æ–∑</option>
                            <option value="–∫—É—Ä–∏—Ä—Å–∫–∞ —Å–ª—É–∂–±–∞">–ö—É—Ä–∏—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–ù–î–° (%)</label>
                        <select id="invoiceVAT">
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="differentDeliveryAddress" style="width: auto;">
                            –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∞–¥—Ä–µ—Å–∞ —Å–µ–¥–∏—à—Ç–∞
                        </label>
                    </div>
                </div>
            </div>

            <!-- –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ -->
            <div id="deliveryAddressSection" class="section-card" style="display: none;">
                <h3>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input" id="deliveryCity" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." autocomplete="off">
                            <div class="dropdown-menu" id="deliveryCityDropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–û–±—â–∏–Ω–∞ *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input" id="deliveryMunicipality" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≥–æ—Ä–æ–¥..." autocomplete="off" disabled>
                            <div class="dropdown-menu" id="deliveryMunicipalityDropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–£–ª–∏—Ü–∞ *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input" id="deliveryStreet" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–Ω—É..." autocomplete="off" disabled>
                            <div class="dropdown-menu" id="deliveryStreetDropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–ù–æ–º–µ—Ä –¥–æ–º–∞</label>
                        <input type="text" id="deliveryHouseNumber" placeholder="–ù–æ–º–µ—Ä –¥–æ–º–∞">
                    </div>
                </div>
            </div>

            <div class="section-card">
                <h3>–¢–æ–≤–∞—Ä—ã</h3>
                <div id="invoiceItems">
                    <div class="invoice-items">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–¢–æ–≤–∞—Ä *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input invoice-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." autocomplete="off">
                                <input type="hidden" class="invoice-product" value="">
                                <div class="dropdown-menu invoice-product-dropdown"></div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                            <input type="number" class="invoice-quantity" value="1" min="1">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–¶–µ–Ω–∞ (RSD)</label>
                            <input type="number" class="invoice-price" readonly style="background: #f8f9fa;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–°—É–º–º–∞ (RSD)</label>
                            <input type="number" class="invoice-amount" readonly style="background: #f8f9fa; font-weight: bold;">
                        </div>
                        <div style="padding-top: 25px;">
                            <button class="btn btn-danger" onclick="removeInvoiceItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addInvoiceItem()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                
                <div class="totals">
                    <div class="totals-row">
                        <span>–ü–æ–¥—Ç–æ—Ç–∞–ª:</span>
                        <span id="invoiceSubtotal">0.00 RSD</span>
                    </div>
                    <div class="totals-row">
                        <span>–ù–î–°:</span>
                        <span id="invoiceVATAmount">0.00 RSD</span>
                    </div>
                    <div class="totals-final">
                        <span>–ò–¢–û–ì–û:</span>
                        <span id="invoiceTotal">0.00 RSD</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="generateInvoice()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–æ–π—Å</button>
                <button class="btn btn-success" onclick="confirmInvoice()">–£—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–Ω–≤–æ–π—Å</button>
                <button class="btn btn-secondary" onclick="generateDeliveryFromInvoice()">–°–æ–∑–¥–∞—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É</button>
            </div>
            
            <div id="invoicePreview" class="preview" style="display: none;">
                <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–æ–π—Å–∞</h3>
                <div id="invoiceContent"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="exportInvoiceToPDF()">–≠–∫—Å–ø–æ—Ä—Ç PDF</button>
                    <button class="btn btn-secondary" onclick="downloadInvoiceAsHTML()">–°–∫–∞—á–∞—Ç—å HTML</button>
                    <button class="btn btn-secondary" onclick="copyInvoiceToClipboard()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div id="invoiceConfirmMessage" style="display: none; margin-top: 15px;" class="alert alert-success">
                    –ò–Ω–≤–æ–π—Å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂!
                </div>
            </div>
        </div>

        <!-- –°–æ–∑–¥–∞—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É -->
        <div id="delivery" class="tab-content">
            <h2>–°–æ–∑–¥–∞—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É</h2>
            
            <div class="company-info">
                <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</h3>
                <p><strong>–°—Ä–µƒß–∞ 2024 –î–û–û –ë–µ–æ–≥—Ä–∞–¥ (–°—Ç–∞—Ä–∏ –ì—Ä–∞–¥)</strong></p>
                <p>–ú–∞—Ç–∏—á–Ω–∏ –±—Ä–æ—ò: 22019309 | –ü–ò–ë: 114407658</p>
                <p>–°–µ–¥–∏—à—Ç–µ: –ë–µ–æ–≥—Ä–∞–¥, –°—Ç–∞—Ä–∏ –ì—Ä–∞–¥, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35</p>
            </div>

            <div class="section-card">
                <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ù–æ–º–µ—Ä –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã *</label>
                        <input type="text" id="deliveryNumber" placeholder="1-DDMMYYYY">
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ *</label>
                        <input type="date" id="deliveryDate">
                    </div>
                    <div class="form-group">
                        <label>–°—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏ *</label>
                        <input type="date" id="deliveryDueDate">
                    </div>
                    <div class="form-group">
                        <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input" id="deliveryClientSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è..." autocomplete="off">
                            <input type="hidden" id="deliveryClient" value="">
                            <div class="dropdown-menu" id="deliveryClientDropdown"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <select id="deliveryMethod">
                            <option value="—Å–æ–ø—Å—Ç–≤–µ–Ω–∏ –ø—Ä–µ–≤–æ–∑">–°–æ–ø—Å—Ç–≤–µ–Ω–∏ –ø—Ä–µ–≤–æ–∑</option>
                            <option value="–∫—É—Ä–∏—Ä—Å–∫–∞ —Å–ª—É–∂–±–∞">–ö—É—Ä–∏—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="section-card">
                <h3>–¢–æ–≤–∞—Ä—ã</h3>
                <div id="deliveryItems">
                    <div class="delivery-items">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–¢–æ–≤–∞—Ä *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input delivery-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." autocomplete="off">
                                <input type="hidden" class="delivery-product" value="">
                                <div class="dropdown-menu delivery-product-dropdown"></div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                            <input type="number" class="delivery-quantity" value="1" min="1">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–ï–¥–∏–Ω–∏—Ü–∞</label>
                            <input type="text" class="delivery-unit" value="–∫–æ–º" readonly>
                        </div>
                        <div style="padding-top: 25px;">
                            <button class="btn btn-danger" onclick="removeDeliveryItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addDeliveryItem()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="generateDelivery()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É</button>
                <button class="btn btn-success" onclick="confirmDelivery()">–£—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É</button>
            </div>
            
            <div id="deliveryPreview" class="preview" style="display: none;">
                <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã</h3>
                <div id="deliveryContent"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="printDelivery()">–≠–∫—Å–ø–æ—Ä—Ç PDF</button>
                </div>
            </div>

            <div class="invoice-list" style="margin-top: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã</h3>
                    <div class="form-group" style="margin: 0; width: 300px;">
                        <select id="deliveryClientFilter" style="margin: 0;" onchange="filterDeliveriesByClient()">
                            <option value="">–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</option>
                        </select>
                    </div>
                </div>
                <div id="confirmedDeliveriesList">
                    <p style="text-align: center; color: #666;">–ù–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü</p>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ -->
        <div id="statistics" class="tab-content">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h2>
            <div class="filter-section">
                <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–ü–µ—Ä–∏–æ–¥ —Å:</label>
                        <input type="date" id="statsFromDate">
                    </div>
                    <div class="form-group">
                        <label>–ü–µ—Ä–∏–æ–¥ –ø–æ:</label>
                        <input type="date" id="statsToDate">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <div>
                            <button class="btn btn-primary" onclick="updateStatistics()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                            <button class="btn btn-success" onclick="exportStatisticsToPDF()">–°–∫–∞—á–∞—Ç—å PDF</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalRevenue">0 RSD</div>
                    <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalInvoices">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∏–Ω–≤–æ–π—Å–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageOrder">0 RSD</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">–í—ã—Ä—É—á–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</div>
                <div id="revenueChart">–ì—Ä–∞—Ñ–∏–∫ –≤—ã—Ä—É—á–∫–∏ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å</div>
            </div>

            <div class="chart-container">
                <div class="chart-title">–¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</div>
                <div id="productsChart">–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ —Ç–æ–≤–∞—Ä–æ–≤ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å</div>
            </div>

            <div class="chart-container">
                <div class="chart-title">–¢–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ</div>
                <div id="clientsChart">–ì—Ä–∞—Ñ–∏–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –∑–¥–µ—Å—å</div>
            </div>

            <div class="invoice-list">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å—ã</h3>
                    <div class="form-group" style="margin: 0; width: 300px;">
                        <input type="text" id="invoiceSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–Ω–≤–æ–π—Å–∞..." style="margin: 0;" oninput="filterInvoicesBySearch()">
                    </div>
                </div>
                <div id="confirmedInvoicesList">
                    <p style="text-align: center; color: #666;">–ù–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤</p>
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div id="logs" class="tab-content">
            <h2>–õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</h2>
            <div id="logsContainer" style="background:#f8f9fa; border-radius:12px; padding:20px; min-height:300px; max-height:600px; overflow-y:auto; border:2px solid #e9ecef;">
                <ul id="logsList" style="list-style:none; padding:0; margin:0;"></ul>
            </div>
            <div style="margin-top: 15px;">
                <button class="btn btn-success" onclick="exportLogsToExcel()">
                    <span style="font-size: 14px; margin-right: 5px;">üìä</span>
                    –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
                <button class="btn btn-secondary" onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="close" onclick="closeAddUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="newUserLogin" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" autocomplete="off">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="newUserPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="confirmUserPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" autocomplete="new-password">
                </div>
                <div id="addUserError" class="login-error" style="display: none;"></div>
            </div>
            <div class="modal-footer" style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="addNewUser()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <button class="btn btn-secondary" onclick="closeAddUserModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="clientHistoryModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="clientHistoryTitle">–ò—Å—Ç–æ—Ä–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <button class="close" onclick="closeClientHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="clientHistoryContent" style="max-height: 500px; overflow-y: auto;">
                    <p style="text-align: center; color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            </div>
            <div class="modal-footer" style="text-align: center; margin-top: 25px;">
                <button class="btn btn-secondary" onclick="closeClientHistoryModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        let clients = [], products = [], confirmedInvoices = [], confirmedDeliveries = [], currentInvoiceData = null;

        // –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—â–∏–Ω –°–µ—Ä–±–∏–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≥–æ—Ä–æ–¥–∞)
        const allMunicipalities = [
            // –ë–µ–æ–≥—Ä–∞–¥ - –≥—Ä–∞–¥—Å–∫–µ –æ–ø—à—Ç–∏–Ω–µ
            "Barajevo", "Vo≈ædovac", "Vraƒçar", "Grocka", "Zvezdara", "Zemun", "Lazarevac", 
            "Mladenovac", "Novi Beograd", "Obrenovac", "Palilula", "Rakovica", "Savski venac", 
            "Sopot", "Stari grad", "Surƒçin", "ƒåukarica",
            
            // –ì—Ä–∞–¥–æ–≤–∏
            "Novi Sad", "Ni≈°", "Kragujevac", "Subotica", "Panƒçevo", "ƒåaƒçak", "Novi Pazar", 
            "Zrenjanin", "Leskovac", "Bor", "Valjevo", "Vranje", "Vr≈°ac", "Zajeƒçar", 
            "Jagodina", "Kikinda", "Kraljevo", "Kru≈°evac", "Loznica", "Pirot", "Po≈æarevac", 
            "Pri≈°tina", "Prokuplje", "Smederevo", "Sombor", "Sremska Mitrovica", "U≈æice", "≈†abac",
            
            // –ú–µ–¥–∏—ò–∞–Ω–∞, –ü–∞–ª–∏–ª—É–ª–∞ (–ù–∏—à)
            "Medijana", "Pantelej", "Crveni Krst", "Ni≈°ka Banja",
            
            // –í—Ä–∞—ö–µ
            "Vranje grad", "Vranje selo",
            
            // –ü–æ–∂–∞—Ä–µ–≤–∞—Ü
            "Po≈æarevac grad", "Kostolac",
            
            // –£–∂–∏—Ü–µ
            "U≈æice grad", "Sevojno",
            
            // –û–ø—à—Ç–∏–Ω–µ
            "Aleksandrovac", "Aleksinac", "Aranƒëelovac", "Arilje", "Babu≈°nica", "Baƒç", 
            "Baƒçka Palanka", "Baƒçka Topola", "Baƒçko Gradi≈°te", "Bajina Ba≈°ta", "Bela Crkva", 
            "Bela Palanka", "Beoƒçin", "Blace", "Bogatiƒá", "Bojnik", "Boljevac", "Bosilegrad", 
            "Brus", "Bujanovac", "ƒåajetina", "ƒåoka", "ƒÜiƒáevac", "ƒÜuprija", "Despotovac", 
            "Dimitrovgrad", "Doljevac", "Gad≈æin Han", "Golubac", "Gornji Milanovac", "Ivanjica", 
            "Irig", "Kanji≈æa", "Kladovo", "Knja≈æevac", "Kniƒá", "Koceljeva", "Kosjeriƒá", "Kovin", 
            "Krupanj", "Kuƒçevo", "Kur≈°umlija", "Lajkovac", "Lapovo", "Lebane", "Ljig", "Ljubovija", 
            "Luƒçani", "Majdanpek", "Malo Crniƒáe", "Medveƒëa", "Mero≈°ina", "Mionica", "Negotin", 
            "Nova Crnja", "Nova Varo≈°", "Novi Beƒçej", "Novi Kne≈æevac", "Od≈æaci", "Opovo", 
            "Oseƒçina", "Paraƒáin", "Peƒáinci", "Petrovac na Mlavi", "Plandi≈°te", "Po≈æega", 
            "Pre≈°evo", "Priboj", "Prijepolje", "Raƒça", "Ra≈°ka", "Ra≈æanj", "Rekovac", "Ruma", 
            "Seƒçanj", "Senta", "≈†id", "Sjenica", "Sokobanja", "Srbobran", "Sremski Karlovci", 
            "Stara Pazova", "Surdulica", "Svilajnac", "Temerin", "Titel", "Topola", "Trstenik", 
            "Tutin", "Ub", "Varvarin", "Velika Plana", "Vladiƒçin Han", "Vladimirci", "Vlasotince", 
            "Vojnik", "Vrbas", "Vrnjaƒçka Banja", "≈Ωabalj", "≈Ωabari", "≈Ωagubica", "≈Ωiti≈°te", "≈Ωitoraƒëa",
            
            // –ë–∞—á–∫–∏ –ü–µ—Ç—Ä–æ–≤–∞—Ü
            "Baƒçki Petrovac", "Kulpin", "Magliƒá", "Glo≈æan",
            
            // –ê–¥–∞
            "Ada", "Mol", "Obornjaƒça",
            
            // –ê–ª–∏–±—É–Ω–∞—Ä
            "Alibunar", "Banatski Karlovci", "Vladimirovac",
            
            // –ê–ø–∞—Ç–∏–Ω
            "Apatin", "Prigrevica", "Kupusina",
            
            // –ò–Ω—í–∏—ò–∞
            "Inƒëija", "Be≈°ka", "Ljukovo", "Maradik",
            
            // –ú–∞–ª–∏ –ò—í–æ—à
            "Mali Iƒëo≈°", "Lovƒáenac", "Feketiƒá"
        ];

        // –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª–∏—Ü—ã (–æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö –æ–±—â–∏–Ω)
        const commonStreets = [
            "–ì–ª–∞–≤–Ω–∞", "–ö–∞—Ä–∞—í–æ—Ä—í–µ–≤–∞", "–ö—Ä–∞—ô–∞ –ü–µ—Ç—Ä–∞", "–°–≤–µ—Ç–æ–≥ –°–∞–≤–µ", "–ù–µ–º–∞—ö–∏–Ω–∞", 
            "–ö–Ω–µ–∑–∞ –ú–∏–ª–æ—à–∞", "–ñ–µ–ª–µ–∑–Ω–∏—á–∫–∞", "–ü–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫–∞", "–û–º–ª–∞–¥–∏–Ω—Å–∫–∞", "–®–∫–æ–ª—Å–∫–∞",
            "–¢—Ä–≥ –æ—Å–ª–æ–±–æ—í–µ—ö–∞", "Bulevar osloboƒëenja", "–î—É–Ω–∞–≤—Å–∫–∞", "–ú–æ—Ä–∞–≤—Å–∫–∞", 
            "–ü—Ä–≤–æ–º–∞—ò—Å–∫–∞", "–ù–∏–∫–æ–ª–µ –ü–∞—à–∏—õ–∞", "–°–≤–µ—Ç–æ–∑–∞—Ä–∞ –ú–∞—Ä–∫–æ–≤–∏—õ–∞", "–î–∏–º–∏—Ç—Ä–∏—ò–∞ –¢—É—Ü–æ–≤–∏—õ–∞",
            "–à–æ–≤–∞–Ω–∞ –à–æ–≤–∞–Ω–æ–≤–∏—õ–∞ –ó–º–∞—ò–∞", "–í—É–∫–∞ –ö–∞—Ä–∞—ü–∏—õ–∞", "–î–æ—Å–∏—Ç–µ—ò–µ–≤–∞", "–ë—Ä–∞—õ–µ –à—É–≥–æ–≤–∏—õ–∞",
            "–ö–Ω–µ–∑ –ú–∏—Ö–∞–∏–ª–æ–≤–∞", "–¢–µ—Ä–∞–∑–∏—ò–µ", "–°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏ —Ç—Ä–≥", "–°–∫–∞–¥–∞—Ä—Å–∫–∞", "–î—É—à–∞–Ω–æ–≤–∞",
            "–ú–∞—Å–∞—Ä–∏–∫–æ–≤–∞", "–ú–∏–ª–µ—Ç–∏—õ–µ–≤–∞", "–§—Ä—É—à–∫–æ–≥–æ—Ä—Å–∫–∞", "–ë–∞–Ω–∞—Ç—Å–∫–∞", "–í–æ—ò–≤–æ—í–∞–Ω—Å–∫–∞",
            "–°—Ä–µ–º—Å–∫–∞", "–ë–∞—á–∫–∞", "–ó–ª–∞—Ç–∏–±–æ—Ä—Å–∫–∞", "–ö–æ–ø–∞–æ–Ω–∏—á–∫–∞", "–†—É–¥–Ω–∏—á–∫–∞", "–®—É–º–∞–¥–∏—ò—Å–∫–∞",
            "Po≈°tanska", "Maksima Gorkog", "Majke Jevrosime", "Kneza Vi≈°eslava",
            "Bulevar kralja Aleksandra", "Bulevar Nemanjiƒáa", "Bulevar despota Stefana"
        ];

        // –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –∏ –æ–±—â–∏–Ω –°–µ—Ä–±–∏–∏
        const addressData = {
            cities: {
                // –ì–†–ê–î–û–í–ò (28 + –ë–µ–æ–≥—Ä–∞–¥)
                "Beograd": {
                    municipalities: ["Barajevo", "Vo≈ædovac", "Vraƒçar", "Grocka", "Zvezdara", "Zemun", "Lazarevac", "Mladenovac", "Novi Beograd", "Obrenovac", "Palilula", "Rakovica", "Savski venac", "Sopot", "Stari grad", "Surƒçin", "ƒåukarica"],
                    streets: {
                        "Stari grad": ["Studentski trg", "Knez Mihailova", "Terazije", "Kralja Petra", "Vasa ƒåarapiƒáa", "Makedonska", "Zeleni venac", "Du≈°anova", "Skadarska", "Kosanƒçiƒáev venac", "Cara Du≈°ana", "Kralja Milana", "Nemanjina", "Resavska", "Balkanska", "Vasina", "Francuska", "U≈æiƒçka", "Pop Lukina", "Dobraƒçina", "Jevremova", "Gospodar Jevremova", "Admirala Geprata", "Gavrila Principa", "Pariska", "Strahinjiƒáa Bana", "Rajiƒáeva", "Tadeu≈°a Ko≈°ƒáu≈°ka", "ƒåika Ljubina", "Bulevar despota Stefana", "Hilandarska", "Simina", "Braƒáe Jugoviƒáa", "Svetogorska", "Dzordza Va≈°ingtona", "Vi≈°egradska", "Prizrenska", "Cara Nikolaja II", "Zmaj Jovina", "Braƒáe Baruh", "Kolarƒçeva", "Venizelosova", "Majke Jevrosime", "ƒåumiƒáeva", "Dimitrija Tucoviƒáa", "Dunavska", "Obilicev venac", "Strahiniƒáa Bana"],
                        "Novi Beograd": ["Bulevar Zorana ƒêinƒëiƒáa", "Bulevar Mihajla Pupina", "Jurija Gagarina", "Gandijeva", "Milentija Popoviƒáa", "Antifa≈°istiƒçke borbe", "Bulevar Arsenija ƒåarnojeviƒáa", "Dr Ivana Ribara", "Omladinskih brigada", "Narodnih heroja", "To≈°in bunar", "Bulevar Nikole Tesle", "Vladimira Popoviƒáa", "ƒêorƒëa Stanojeviƒáa", "Nehruova", "Save Kovaƒçeviƒáa", "Kornelija Stankoviƒáa", "Partizanske avijacije"],
                        "Vo≈ædovac": ["Bulevar osloboƒëenja", "Ustaniƒçka", "Veljka Dugo≈°eviƒáa", "Autoput za Ni≈°", "Kumodra≈°ka", "Crnotravska", "Tre≈°njinog cveta", "Patrijarha Dimitrija", "Ju≈æni bulevar", "Medakoviƒáeva", "Braƒáe Jerkoviƒá", "Vojvode Stepe", "Humska", "Banjiƒçka"],
                        "Vraƒçar": ["Bulevar kralja Aleksandra", "Krunska", "Kneginje Zorke", "Svetosavska", "Njego≈°eva", "ƒåarlija ƒåaplina", "Maksima Gorkog", "Karaƒëorƒëeva", "Beogradska", "Neimarska", "Despota Stefana", "Kataniƒáeva", "Kralja Milana", "Deƒçanska"],
                        "Zvezdara": ["Bulevar kralja Aleksandra", "Dimitrija Tucoviƒáa", "Milana Rakiƒáa", "Cvijiƒáeva", "Veljka Vlahoviƒáa", "Dragoslava Srejoviƒáa", "Alekse Nenadoviƒáa", "Ruzveltova", "Uƒçiteljska", "Bulevar Mihajla Pupina", "Djure Jak≈°iƒáa"],
                        "Zemun": ["Glavna", "Cara Du≈°ana", "Zemunski kej", "Magistratski trg", "Karamatina", "Dubrovaƒçka", "Gorkoga", "To≈°in bunar", "Batajniƒçki drum", "Ugrinovaƒçka", "Beƒçkereƒçka", "Prvomajska"],
                        "ƒåukarica": ["Po≈æe≈°ka", "Patrijarha Dimitrija", "Kneza Vi≈°eslava", "Ibarska magistrala", "Radniƒçka", "Banovo brdo", "ƒåukariƒçka", "Banjica", "Sremƒçica", "≈Ωelezniƒçka"],
                        "Palilula": ["Dunavska", "Francuska", "Visokog Stevana", "Uƒçiteljska", "Dalmatinska", "Cara Nikolaja II", "Bulevar despota Stefana", "Ruzveltova", "Vi≈°njiƒáeva", "Tadeu≈°a Ko≈°ƒáu≈°ka"],
                        "Savski venac": ["Nemanjina", "Karaƒëorƒëeva", "Bulevar vojvode Mi≈°iƒáa", "Kneza Milo≈°a", "Sarajevska", "Hajduk Veljkova", "Gavrila Principa", "Resavska", "Prizrenska", "Svetog Save"],
                        "Rakovica": ["Borska", "Patrijarha Dimitrija", "Rakoviƒçka", "Ibarska magistrala", "Kneza Vi≈°eslava", "Trgovaƒçka", "Milo≈°a Obrenoviƒá", "Crnotravska"],
                        "Grocka": ["Smederevski put", "Boljevaƒçka", "Grocka", "Pukovnika Milenka Pavloviƒáa", "Viniƒçka", "Boleƒç", "Begaljica"],
                        "Lazarevac": ["Kralja Petra", "Svetog Save", "Trg osloboƒëenja", "Nemanjina", "Bulevar osloboƒëenja", "Ibarska magistrala", "Stevan Mokranjac"],
                        "Mladenovac": ["Kralja Aleksandra", "Svetog Save", "Nemanjina", "Trg osloboƒëenja", "Karaƒëorƒëeva", "Kosmajska", "Jagodinska"],
                        "Obrenovac": ["Kralja Petra", "Milo≈°a Obrenoviƒáa", "Vuka Karad≈æiƒáa", "Cara Lazara", "Trg osloboƒëenja", "Obiliƒáeva", "Zmaj Jovina"],
                        "Sopot": ["Sopot", "Kosmajska", "Nemenikuƒáe", "Duƒçina", "Parcani", "Rogaƒça"],
                        "Surƒçin": ["Surƒçin", "Beƒçkereƒçka", "Dobanovci", "Petrovƒçiƒá", "Boljevci", "Jakovo"],
                        "Barajevo": ["Barajevo", "Arnajevo", "Bo≈ædarevac", "Guncati", "Maniƒá", "≈†iljakovac"]
                    }
                },
                "Novi Sad": {
                    municipalities: ["Novi Sad"],
                    streets: {
                        "Novi Sad": ["Bulevar osloboƒëenja", "Zmaj Jovina", "Dunavska", "Kralja Aleksandra", "Miletiƒáeva", "Futo≈°ka", "Bulevar cara Lazara", "Narodnog fronta", "Stra≈æe Novosadske", "Jevrejska", "Katoliƒçka porta", "Grƒçka", "Masarikova", "Jovana ƒêorƒëeviƒáa", "Modene", "Ilije Ognjanoviƒáa", "Svetozara Miletiƒáa", "Vladimira Nazora", "Kisaƒçka", "Bulevar Evrope"]
                    }
                },
                "Ni≈°": {
                    municipalities: ["Medijana", "Palilula", "Pantelej", "Crveni Krst", "Ni≈°ka Banja"],
                    streets: {
                        "Medijana": ["Bulevar Nemanjiƒáa", "Obrenoviƒáeva", "Vozda Karaƒëorƒëa", "Dr Zoran ƒêinƒëiƒá", "Bulevar 12. februar", "Du≈°anova", "Kneginje Ljubice"],
                        "Palilula": ["Cara Du≈°ana", "Bulevar Evrope", "Ja≈°e Prodanoviƒáa", "Stevana Mokranjca", "Vojvode Tankosiƒáa", "Had≈æi Milentijeva"],
                        "Pantelej": ["Bulevar Nemanjiƒáa", "Partizanska", "ƒÜirila i Metodija", "Stevana Sremca", "Kneginje Milice"],
                        "Crveni Krst": ["Bulevar Evrope", "Partizanska", "Vojvode Tankosiƒáa", "Stevana Mokranjca"],
                        "Ni≈°ka Banja": ["Sinƒëeliƒáeva", "Dr Milutina Ivkoviƒáa", "≈Ωelezniƒçka", "Knjeginje Milice"]
                    }
                },
                "Kragujevac": {
                    municipalities: ["Kragujevac"],
                    streets: {
                        "Kragujevac": ["Kralja Aleksandra", "Svetozara Markoviƒáa", "Dositejeva", "Bulevar kraljice Marije", "Jovana Cvijiƒáa", "Kneza Mihaila", "Nikole Pa≈°iƒáa", "Cara Lazara", "ƒêure ƒêakoviƒáa", "Kralja Petra"]
                    }
                },
                "Subotica": {
                    municipalities: ["Subotica"],
                    streets: {
                        "Subotica": ["Trg slobode", "Korzo", "Matice srpske", "Segedinski put", "Cara Lazara", "Maksima Gorkog", "ƒêure ƒêakoviƒáa", "Ra≈°e Konƒçara", "Somborska", "Banatska"]
                    }
                },
                "Panƒçevo": {
                    municipalities: ["Panƒçevo"],
                    streets: {
                        "Panƒçevo": ["Trg kralja Petra", "≈Ωelezniƒçka", "Svetog Save", "Cara Lazara", "Dimitrija Tucoviƒáa", "Vojvodine", "Milo≈°a Trebinjca", "Braƒáe Jovanoviƒá", "ƒêure ƒêakoviƒáa"]
                    }
                },
                "ƒåaƒçak": {
                    municipalities: ["ƒåaƒçak"],
                    streets: {
                        "ƒåaƒçak": ["Bulevar oslobodilaca", "Kneza Mihaila", "≈Ωiƒçka", "Cara Du≈°ana", "Svetog Save", "Nikole Pa≈°iƒáa", "Prvomajska", "Dimitrija Tucoviƒáa"]
                    }
                },
                "Novi Pazar": {
                    municipalities: ["Novi Pazar"],
                    streets: {
                        "Novi Pazar": ["28. novembar", "Stevana Nemanje", "Rifata Burd≈æoviƒáa", "Alije Izetbegoviƒáa", "Generala ≈Ωivkoviƒáa", "Vuka Karad≈æiƒáa", "Sutjeska"]
                    }
                },
                "Zrenjanin": {
                    municipalities: ["Zrenjanin"],
                    streets: {
                        "Zrenjanin": ["Trg slobode", "Kralja Aleksandra", "ƒêure ƒêakoviƒáa", "Bulevar ƒêorƒëa Vajferta", "Seƒçanj", "Dimitrija Tucoviƒáa", "Maksima Gorkog"]
                    }
                },
                "Leskovac": {
                    municipalities: ["Leskovac"],
                    streets: {
                        "Leskovac": ["Bulevar osloboƒëenja", "Stevana Mokranjca", "Cara Du≈°ana", "Nikole Pa≈°iƒáa", "Bulevar heroes", "≈Ωitni trg", "Svetozara Markoviƒáa"]
                    }
                },
                "Bor": {
                    municipalities: ["Bor"],
                    streets: {
                        "Bor": ["Mo≈°e Pijade", "7. jula", "ƒêorƒëa Vajferta", "Trg osloboƒëenja", "Kralja Petra"]
                    }
                },
                "Valjevo": {
                    municipalities: ["Valjevo"],
                    streets: {
                        "Valjevo": ["Karaƒëorƒëeva", "Vladike Nikolaja", "Birƒçaninova", "Vojvode Mi≈°iƒáa", "Kneza Milo≈°a"]
                    }
                },
                "Vranje": {
                    municipalities: ["Vranje grad", "Vranje selo"],
                    streets: {
                        "Vranje grad": ["Kralja Stefana Prvovenƒçanog", "Svetozara Markoviƒáa", "Prvomajska", "Kralja Aleksandra", "Titova"],
                        "Vranje selo": ["Seoska ulica", "Glavna", "Centralna"]
                    }
                },
                "Vr≈°ac": {
                    municipalities: ["Vr≈°ac"],
                    streets: {
                        "Vr≈°ac": ["Svetosavska", "Trg pobede", "Heroja Pinkija", "Abrahama Linkolna", "Vojvoƒëanska"]
                    }
                },
                "Zajeƒçar": {
                    municipalities: ["Zajeƒçar"],
                    streets: {
                        "Zajeƒçar": ["Kralja Aleksandra", "Svetozara Markoviƒáa", "Hajduk Veljkova", "Nikole Pa≈°iƒáa", "Kneginje Ljubice"]
                    }
                },
                "Jagodina": {
                    municipalities: ["Jagodina"],
                    streets: {
                        "Jagodina": ["Kneginje Milice", "Svetozara Markoviƒáa", "Karadjordjeva", "Kralja Petra", "Nikole Pa≈°iƒáa"]
                    }
                },
                "Kikinda": {
                    municipalities: ["Kikinda"],
                    streets: {
                        "Kikinda": ["Trg srpskih dobrovoljaca", "Svetosavska", "Gospodara Vuƒçiƒáa", "Seƒçeranska", "≈Ωarka Zrenjanina"]
                    }
                },
                "Kraljevo": {
                    municipalities: ["Kraljevo"],
                    streets: {
                        "Kraljevo": ["Kraljice Marije", "Karaƒëorƒëeva", "Omladinska", "Trg srpskih ratnika", "Nemanjina"]
                    }
                },
                "Kru≈°evac": {
                    municipalities: ["Kru≈°evac"],
                    streets: {
                        "Kru≈°evac": ["Kneza Milo≈°a", "Gazimestanska", "Vidovdanska", "ƒÜele kule", "Majke Jugoviƒáa"]
                    }
                },
                "Loznica": {
                    municipalities: ["Loznica"],
                    streets: {
                        "Loznica": ["Kneza Milo≈°a", "Karaƒëorƒëeva", "Vuka Karad≈æiƒáa", "Pasiƒáeva", "Jovan Cvijiƒá"]
                    }
                },
                "Pirot": {
                    municipalities: ["Pirot"],
                    streets: {
                        "Pirot": ["Srpskih vladara", "Kralja Petra", "Nikole Pa≈°iƒáa", "Trg pobede", "Beogradska"]
                    }
                },
                "Po≈æarevac": {
                    municipalities: ["Po≈æarevac grad", "Kostolac"],
                    streets: {
                        "Po≈æarevac grad": ["Dunavska", "Karaƒëorƒëeva", "Svetozara Markoviƒáa", "Kneza Milo≈°a", "Drinƒçiƒáeva"],
                        "Kostolac": ["Glavna", "Termoelektrane", "Rudarska", "Drinƒçiƒáeva"]
                    }
                },
                "Pri≈°tina": {
                    municipalities: ["Pri≈°tina"],
                    streets: {
                        "Pri≈°tina": ["Kralja Petra", "Lole Ribara", "Omladinska", "Deƒçanska", "Vidovdanska"]
                    }
                },
                "Prokuplje": {
                    municipalities: ["Prokuplje"],
                    streets: {
                        "Prokuplje": ["Topliƒçina", "Karaƒëorƒëeva", "Vojvode Stepe", "Svetog Save", "Nikole Pa≈°iƒáa"]
                    }
                },
                "Smederevo": {
                    municipalities: ["Smederevo"],
                    streets: {
                        "Smederevo": ["Kralja Petra", "Dunavska", "Omladinska", "ƒêuri≈°ka", "Svetog ƒêorƒëa"]
                    }
                },
                "Sombor": {
                    municipalities: ["Sombor"],
                    streets: {
                        "Sombor": ["Trg cara Uro≈°a", "–ê–ø–∞—Ç–∏–Ω—Å–∫–∏ –ø—É—Ç", "–í–µ–Ω–∞—Ü –≤–æ—ò–≤–æ–¥–µ –°—Ç–µ–ø–µ", "–í–æ—ò–≤–æ–¥–µ –ü—É—Ç–Ω–∏–∫–∞", "–ö–Ω–µ–∑–∞ –ú–∏—Ö–∞–∏–ª–∞"]
                    }
                },
                "Sremska Mitrovica": {
                    municipalities: ["Sremska Mitrovica"],
                    streets: {
                        "Sremska Mitrovica": ["–°–≤–µ—Ç–æ–≥ –î–∏–º–∏—Ç—Ä–∏—ò–∞", "–ö—Ä–∞—ô–∞ –ü–µ—Ç—Ä–∞", "–ñ–µ–ª–µ–∑–Ω–∏—á–∫–∞", "–§—Ä—É—à–∫–æ–≥–æ—Ä—Å–∫–∞", "–í–æ—ò–≤–æ—í–∞–Ω—Å–∫–∞"]
                    }
                },
                "U≈æice": {
                    municipalities: ["U≈æice grad", "Sevojno"],
                    streets: {
                        "U≈æice grad": ["–ü–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫–∞", "–î–∏–º–∏—Ç—Ä–∏—ò–∞ –¢—É—Ü–æ–≤–∏—õ–∞", "–ú–∏–ª–æ—à–∞ –û–±–∏–ª–∏—õ–∞", "–¢—Ä–≥ –ø–∞—Ä—Ç–∏–∑–∞–Ω–∞", "–ù–µ–º–∞—ö–∏–Ω–∞"],
                        "Sevojno": ["–ó–ª–∞—Ç–∏–±–æ—Ä—Å–∫–∞", "–ú–∏–ª–∞–Ω–∞ –†–∞–∫–∏—õ–∞", "–°–≤–µ—Ç–æ–≥ –°–∞–≤–µ", "–ñ–µ–ª–µ–∑–Ω–∏—á–∫–∞"]
                    }
                },
                "≈†abac": {
                    municipalities: ["≈†abac"],
                    streets: {
                        "≈†abac": ["–ö–∞—Ä–∞—í–æ—Ä—í–µ–≤–∞", "–ú–∞—Å–∞—Ä–∏–∫–æ–≤–∞", "–•–∞—ò–¥—É–∫ –í–µ—ô–∫–æ–≤–∞", "–¢—Ä–≥ –æ—Å–ª–æ–±–æ—í–µ—ö–∞", "–í–æ—ò–≤–æ–¥–µ –ú–∏—à–∏—õ–∞"]
                    }
                },
                // –í–ï–ã–ò –û–ü–®–¢–ò–ù–°–ö–ò –¶–ï–ù–¢–†–ò
                "Aleksandrovac": {
                    municipalities: ["Aleksandrovac"],
                    streets: {
                        "Aleksandrovac": ["–ö–∞—Ä–∞—í–æ—Ä—í–µ–≤–∞", "–ì–ª–∞–≤–Ω–∞", "–ñ—É–ø—Å–∫–∞", "–ù–µ–º–∞—ö–∏–Ω–∞", "–¢–æ–ø–ª–∏—á–∫–∞"]
                    }
                },
                "Aleksinac": {
                    municipalities: ["Aleksinac"],
                    streets: {
                        "Aleksinac": ["–ö–∞—Ä–∞—í–æ—Ä—í–µ–≤–∞", "–ú–æ—Ä–∞–≤—Å–∫–∞", "–ö—Ä–∞—ô–µ–≤—Å–∫–∞", "–ù–µ–º–∞—ö–∏–Ω–∞", "–°–≤–µ—Ç–æ–≥ –°–∞–≤–µ"]
                    }
                },
                "Aranƒëelovac": {
                    municipalities: ["Aranƒëelovac"],
                    streets: {
                        "Aranƒëelovac": ["–ö–∞—Ä–∞—í–æ—Ä—í–µ–≤–∞", "–ö—Ä–∞—ô–∞ –ü–µ—Ç—Ä–∞", "–ë–∞—ö—Å–∫–∞", "–ö–Ω–µ–∑–∞ –ú–∏–ª–æ—à–∞", "–û–º–ª–∞–¥–∏–Ω—Å–∫–∞"]
                    }
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
            setCurrentDate();
            generateDocumentNumbers();
            initializeStatistics();
            updateSelectOptions();
            initializeAddressSearch();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–∞ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
            document.getElementById('differentDeliveryAddress').addEventListener('change', function() {
                const section = document.getElementById('deliveryAddressSection');
                if (this.checked) {
                    section.style.display = 'block';
                    initializeDeliveryAddressSearch();
                } else {
                    section.style.display = 'none';
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–∞ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞
            document.getElementById('manualAddressInput').addEventListener('change', function() {
                const automaticSection = document.getElementById('automaticAddressSection');
                const manualSection = document.getElementById('manualAddressSection');
                
                if (this.checked) {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
                    automaticSection.style.display = 'none';
                    manualSection.style.display = 'block';
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
                    document.getElementById('clientCity').value = '';
                    document.getElementById('clientMunicipality').value = '';
                    document.getElementById('clientStreet').value = '';
                    document.getElementById('clientHouseNumber').value = '';
                } else {
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥
                    automaticSection.style.display = 'block';
                    manualSection.style.display = 'none';
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
                    document.getElementById('clientManualAddress').value = '';
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
                    const municipalityInput = document.getElementById('clientMunicipality');
                    const streetInput = document.getElementById('clientStreet');
                    if (municipalityInput) {
                        municipalityInput.disabled = true;
                        municipalityInput.placeholder = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≥–æ—Ä–æ–¥...';
                    }
                    if (streetInput) {
                        streetInput.disabled = true;
                        streetInput.placeholder = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–Ω—É...';
                    }
                }
            });

            // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('invoiceViewModal');
                if (modal && e.target === modal) {
                    closeInvoiceViewModal();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('invoiceViewModal');
                    if (modal) {
                        closeInvoiceViewModal();
                    }
                }
            });
        });

        function initializeAddressSearch() {
            setupCitySearch('clientCity', 'clientCityDropdown', 'clientMunicipality', 'clientMunicipalityDropdown', 'clientStreet', 'clientStreetDropdown');
        }

        function initializeDeliveryAddressSearch() {
            setupCitySearch('deliveryCity', 'deliveryCityDropdown', 'deliveryMunicipality', 'deliveryMunicipalityDropdown', 'deliveryStreet', 'deliveryStreetDropdown');
        }

        function setupCitySearch(cityInputId, cityDropdownId, municipalityInputId, municipalityDropdownId, streetInputId, streetDropdownId) {
            const cityInput = document.getElementById(cityInputId);
            const cityDropdown = document.getElementById(cityDropdownId);
            const municipalityInput = document.getElementById(municipalityInputId);
            const municipalityDropdown = document.getElementById(municipalityDropdownId);
            const streetInput = document.getElementById(streetInputId);
            const streetDropdown = document.getElementById(streetDropdownId);

            if (!cityInput || !cityDropdown) return;

            // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–æ–≤
            cityInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                
                if (query.length === 0) {
                    cityDropdown.style.display = 'none';
                    enableMunicipalityInput();
                    return;
                }

                const filteredCities = Object.keys(addressData.cities).filter(city => 
                    city.toLowerCase().includes(query)
                );

                if (filteredCities.length === 0) {
                    cityDropdown.style.display = 'none';
                    return;
                }

                cityDropdown.innerHTML = '';
                filteredCities.forEach(city => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.textContent = city;
                    item.addEventListener('click', function() {
                        cityInput.value = city;
                        cityDropdown.style.display = 'none';
                        enableMunicipalityInput();
                    });
                    cityDropdown.appendChild(item);
                });

                cityDropdown.style.display = 'block';
            });

            cityInput.addEventListener('blur', function() {
                setTimeout(() => {
                    cityDropdown.style.display = 'none';
                }, 200);
            });

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–ª–µ –æ–±—â–∏–Ω –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞
            function enableMunicipalityInput() {
                if (!municipalityInput || !municipalityDropdown) return;
                
                municipalityInput.disabled = false;
                municipalityInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—â–∏–Ω—ã...';
                municipalityInput.value = '';
                
                setupMunicipalitySearch();
            }

            function setupMunicipalitySearch() {
                if (!municipalityInput || !municipalityDropdown) return;

                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const newMunicipalityInput = municipalityInput.cloneNode(true);
                municipalityInput.parentNode.replaceChild(newMunicipalityInput, municipalityInput);
                const updatedMunicipalityInput = document.getElementById(municipalityInputId);
                const updatedMunicipalityDropdown = document.getElementById(municipalityDropdownId);

                updatedMunicipalityInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    
                    if (query.length === 0) {
                        updatedMunicipalityDropdown.style.display = 'none';
                        resetStreet();
                        return;
                    }

                    const filteredMunicipalities = allMunicipalities.filter(municipality => 
                        municipality.toLowerCase().includes(query)
                    );

                    if (filteredMunicipalities.length === 0) {
                        updatedMunicipalityDropdown.style.display = 'none';
                        return;
                    }

                    updatedMunicipalityDropdown.innerHTML = '';
                    filteredMunicipalities.forEach(municipality => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.textContent = municipality;
                        item.addEventListener('click', function() {
                            updatedMunicipalityInput.value = municipality;
                            updatedMunicipalityDropdown.style.display = 'none';
                            enableStreetInput();
                        });
                        updatedMunicipalityDropdown.appendChild(item);
                    });

                    updatedMunicipalityDropdown.style.display = 'block';
                });

                updatedMunicipalityInput.addEventListener('focus', function() {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ–±—â–∏–Ω—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
                    updatedMunicipalityDropdown.innerHTML = '';
                    allMunicipalities.forEach(municipality => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.textContent = municipality;
                        item.addEventListener('click', function() {
                            updatedMunicipalityInput.value = municipality;
                            updatedMunicipalityDropdown.style.display = 'none';
                            enableStreetInput();
                        });
                        updatedMunicipalityDropdown.appendChild(item);
                    });
                    updatedMunicipalityDropdown.style.display = 'block';
                });

                updatedMunicipalityInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        updatedMunicipalityDropdown.style.display = 'none';
                    }, 200);
                });
            }

            function enableStreetInput() {
                if (!streetInput || !streetDropdown) return;
                
                streetInput.disabled = false;
                streetInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ª–∏—Ü—ã...';
                streetInput.value = '';
                
                setupStreetSearch();
            }

            function setupStreetSearch() {
                if (!streetInput || !streetDropdown) return;

                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const newStreetInput = streetInput.cloneNode(true);
                streetInput.parentNode.replaceChild(newStreetInput, streetInput);
                const updatedStreetInput = document.getElementById(streetInputId);
                const updatedStreetDropdown = document.getElementById(streetDropdownId);

                updatedStreetInput.addEventListener('input', function() {
                    const query = this.value.toLowerCase();
                    
                    if (query.length === 0) {
                        updatedStreetDropdown.style.display = 'none';
                        return;
                    }

                    const filteredStreets = commonStreets.filter(street => 
                        street.toLowerCase().includes(query)
                    );

                    if (filteredStreets.length === 0) {
                        updatedStreetDropdown.style.display = 'none';
                        return;
                    }

                    updatedStreetDropdown.innerHTML = '';
                    filteredStreets.forEach(street => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.textContent = street;
                        item.addEventListener('click', function() {
                            updatedStreetInput.value = street;
                            updatedStreetDropdown.style.display = 'none';
                        });
                        updatedStreetDropdown.appendChild(item);
                    });

                    updatedStreetDropdown.style.display = 'block';
                });

                updatedStreetInput.addEventListener('focus', function() {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —É–ª–∏—Ü—ã –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
                    updatedStreetDropdown.innerHTML = '';
                    commonStreets.forEach(street => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.textContent = street;
                        item.addEventListener('click', function() {
                            updatedStreetInput.value = street;
                            updatedStreetDropdown.style.display = 'none';
                        });
                        updatedStreetDropdown.appendChild(item);
                    });
                    updatedStreetDropdown.style.display = 'block';
                });

                updatedStreetInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        updatedStreetDropdown.style.display = 'none';
                    }, 200);
                });
            }

            function resetStreet() {
                if (streetInput) {
                    streetInput.value = '';
                    streetInput.disabled = true;
                    streetInput.placeholder = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–Ω—É...';
                }
            }
        }

        function loadInitialData() {
            clients = [
                { name: "SVDA DOO", mb: "22058282", pib: "114703885", address: "Beograd, Stari grad, Majke Jevrosime 19", contact: "", bank: "", city: "Beograd", municipality: "Stari grad", street: "Majke Jevrosime", houseNumber: "19" },
                { name: "AUDITORIA DOO BEOGRAD", mb: "22043277", pib: "114586673", address: "Beograd, Vo≈ædovac, Vojvode Dobrnca 48", contact: "", bank: "190-0000000097100 (–ê–ª—Ç–∞ –±–∞–Ω–∫–∞ –ê.–î.)", city: "Beograd", municipality: "Vo≈ædovac", street: "Vojvode Dobrnca", houseNumber: "48" },
                { name: "Aleksandra Tarasenko PR", mb: "67249208", pib: "114000935", address: "Novi Sad, Novi Sad, Masarikova 18", contact: "Ugostiteljska radnja Seal & Tea", bank: "", city: "Novi Sad", municipality: "Novi Sad", street: "Masarikova", houseNumber: "18" },
                { name: "Vera Organic Coffee and Tea doo", mb: "21886866", pib: "113543561", address: "Beograd, Stari grad, Nikole Spasiƒáa 4", contact: "avmofficebg@gmail.com, 063/773-6698", bank: "", city: "Beograd", municipality: "Stari grad", street: "Nikole Spasiƒáa", houseNumber: "4" },
                { name: "ƒåETIRI COFFEE DOO", mb: "22057146", pib: "114695557", address: "Beograd, Stari grad, Terazije 36", contact: "", bank: "", city: "Beograd", municipality: "Stari grad", street: "Terazije", houseNumber: "36" }
            ];

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å—ã —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏
            const savedInvoices = localStorage.getItem('confirmedInvoices');
            if (savedInvoices) {
                try {
                    confirmedInvoices = JSON.parse(savedInvoices);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω–≤–æ–π—Å–æ–≤ –∏–∑ localStorage:', e);
                    confirmedInvoices = [];
                }
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã
            const savedDeliveries = localStorage.getItem('confirmedDeliveries');
            if (savedDeliveries) {
                try {
                    confirmedDeliveries = JSON.parse(savedDeliveries);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü –∏–∑ localStorage:', e);
                    confirmedDeliveries = [];
                }
            }

            products = [
                { code: "GF-B-TG210", name: "Tieguanyin/Zeleni ƒåaj 210g", price: 2297, category: "Zeleni ƒåaj" },
                { code: "GF-B-EG210", name: "Earl Grey/Crni ƒåaj 210g", price: 1850, category: "Crni ƒåaj" },
                { code: "GF-G-JG210", name: "Jasmine Green Beverage/Zeleni ƒåaj 210g", price: 1837, category: "Zeleni ƒåaj" },
                { code: "GF-G-SN210", name: "Sencha/Zeleni ƒåaj 210g", price: 1575, category: "Zeleni ƒåaj" },
                { code: "GF-B-MO210", name: "Milky Oolong/Zeleni ƒåaj 210g", price: 2167, category: "Zeleni ƒåaj" },
                { code: "FJN-B-DHP210", name: "Da Hong Pao/Crni ƒåaj 210g", price: 2691, category: "Crni ƒåaj" },
                { code: "FJN-B-GAB210", name: "Gaba Oolong –ê–ê/Crni ƒåaj 210g", price: 4854, category: "Crni ƒåaj" },
                { code: "FJN-B-DHP28", name: "Da Hong Pao/Crni ƒåaj 28g", price: 359, category: "Crni ƒåaj" },
                { code: "GF-W-BMD28", name: "Bai mu dan/Zeleni ƒåaj 28g", price: 332, category: "Zeleni ƒåaj" },
                { code: "FJN-B-TG28", name: "Tieguanyin/Zeleni ƒåaj 28g", price: 307, category: "Zeleni ƒåaj" },
                { code: "CHC-B-LS28", name: "Lapsang Souchong Black Tea/Crni ƒåaj 28g", price: 315, category: "Crni ƒåaj" },
                { code: "CHC-G-MPC25-5", name: "Golden tocha round Pu Erh/Crni ƒåaj 5g", price: 62, category: "Crni ƒåaj" },
                { code: "CHC-PU-RS10", name: "Puer Chagao Resin Round/Crni ƒåaj 1g", price: 32, category: "Crni ƒåaj" },
                { code: "FJN-B-GAB28", name: "Gaba Oolong –ê–ê/Crni ƒåaj 28g", price: 648, category: "Crni ƒåaj" },
                { code: "FJN-B-MO28", name: "Milky Oolong/Zeleni ƒåaj 28g", price: 289, category: "Zeleni ƒåaj" },
                { code: "GF-B-EG28", name: "Earl Grey/Crni ƒåaj 28g", price: 307, category: "Crni ƒåaj" },
                { code: "GF-G-SN28", name: "Sencha/Zeleni ƒåaj 28g", price: 210, category: "Zeleni ƒåaj" },
                { code: "GF-G-JG28", name: "Jasmine Green Beverage/Zeleni ƒåaj 28g", price: 245, category: "Zeleni ƒåaj" },
                { code: "CHC-B-LS210", name: "Lapsang Souchong Black Tea/Crni ƒåaj 210g", price: 2100, category: "Crni ƒåaj" },
                { code: "GF-B-KM210", name: "Keemum/Crni ƒåaj 210g", price: 1950, category: "Crni ƒåaj" }
            ];
            renderClientsTable();
            renderProductsTable();
            updateDeliveryClientFilter();
            updateDeliveriesList();
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];

            document.getElementById('invoiceDate').value = today;
            document.getElementById('invoiceDueDate').value = nextWeekStr;
            document.getElementById('deliveryDate').value = today;
            document.getElementById('deliveryDueDate').value = nextWeekStr;
        }

        function generateDocumentNumbers() {
            const today = new Date();
            const dateStr = `${String(today.getDate()).padStart(2, '0')}${String(today.getMonth() + 1).padStart(2, '0')}${today.getFullYear()}`;
            document.getElementById('invoiceNumber').value = `1-${dateStr}`;
            document.getElementById('deliveryNumber').value = `1-${dateStr}`;
        }

        function updateSelectOptions() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
            initializeClientSearch('invoiceClientSearch', 'invoiceClient', 'invoiceClientDropdown');
            initializeClientSearch('deliveryClientSearch', 'deliveryClient', 'deliveryClientDropdown');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
            initializeProductSearch();
        }

        function initializeClientSearch(inputId, hiddenId, dropdownId) {
            const input = document.getElementById(inputId);
            const hidden = document.getElementById(hiddenId);
            const dropdown = document.getElementById(dropdownId);
            
            if (!input || !hidden || !dropdown) return;

            input.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                hidden.value = '';
                
                if (query.length === 0) {
                    dropdown.style.display = 'none';
                    return;
                }

                const filteredClients = clients.filter(client => 
                    client.name.toLowerCase().includes(query) ||
                    client.mb.includes(query) ||
                    client.pib.includes(query)
                );

                if (filteredClients.length === 0) {
                    dropdown.style.display = 'none';
                    return;
                }

                dropdown.innerHTML = '';
                filteredClients.forEach((client, index) => {
                    const originalIndex = clients.findIndex(c => c.name === client.name && c.mb === client.mb);
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.innerHTML = `
                        <div style="font-weight: bold;">${client.name}</div>
                        <div style="font-size: 12px; color: #666;">–ú–ë: ${client.mb} | –ü–ò–ë: ${client.pib}</div>
                        <div style="font-size: 12px; color: #888;">${client.address}</div>
                    `;
                    item.addEventListener('click', function() {
                        input.value = client.name;
                        hidden.value = originalIndex;
                        dropdown.style.display = 'none';
                    });
                    dropdown.appendChild(item);
                });

                dropdown.style.display = 'block';
            });

            input.addEventListener('focus', function() {
                if (this.value && dropdown.children.length > 0) {
                    dropdown.style.display = 'block';
                }
            });

            input.addEventListener('blur', function() {
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            });
        }

        function initializeProductSearch() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π —Ç–æ–≤–∞—Ä–æ–≤
            document.querySelectorAll('.invoice-product-search').forEach(input => {
                setupProductSearch(input);
            });
            
            document.querySelectorAll('.delivery-product-search').forEach(input => {
                setupProductSearch(input);
            });
        }

        function setupProductSearch(input) {
            const container = input.closest('.searchable-select');
            const hidden = container.querySelector('.invoice-product, .delivery-product');
            const dropdown = container.querySelector('.invoice-product-dropdown, .delivery-product-dropdown');
            
            if (!hidden || !dropdown) return;

            input.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                hidden.value = '';
                
                if (query.length === 0) {
                    dropdown.style.display = 'none';
                    return;
                }

                const filteredProducts = products.filter(product => 
                    product.code.toLowerCase().includes(query) ||
                    product.name.toLowerCase().includes(query) ||
                    product.category.toLowerCase().includes(query)
                );

                if (filteredProducts.length === 0) {
                    dropdown.style.display = 'none';
                    return;
                }

                dropdown.innerHTML = '';
                filteredProducts.forEach(product => {
                    const originalIndex = products.findIndex(p => p.code === product.code);
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.innerHTML = `
                        <div style="font-weight: bold;">${product.code} - ${product.name}</div>
                        <div style="font-size: 12px; color: #666;">–¶–µ–Ω–∞: ${product.price.toFixed(2)} RSD | –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${product.category}</div>
                    `;
                    item.addEventListener('click', function() {
                        input.value = `${product.code} - ${product.name}`;
                        hidden.value = originalIndex;
                        dropdown.style.display = 'none';
                        
                        // –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É –¥–ª—è –∏–Ω–≤–æ–π—Å–æ–≤
                        if (hidden.classList.contains('invoice-product')) {
                            updateInvoiceItemPriceFromSearch(hidden);
                        }
                    });
                    dropdown.appendChild(item);
                });

                dropdown.style.display = 'block';
            });

            input.addEventListener('focus', function() {
                if (this.value && dropdown.children.length > 0) {
                    dropdown.style.display = 'block';
                }
            });

            input.addEventListener('blur', function() {
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            });
        }

        function updateInvoiceItemPriceFromSearch(hiddenInput) {
            const row = hiddenInput.closest('.invoice-items');
            if (!row) return;
            
            const productIndex = hiddenInput.value;
            
            if (productIndex !== '') {
                const product = products[productIndex];
                const priceInput = row.querySelector('.invoice-price');
                const quantityInput = row.querySelector('.invoice-quantity');
                const amountInput = row.querySelector('.invoice-amount');
                
                priceInput.value = product.price.toFixed(2);
                const quantity = parseInt(quantityInput.value) || 1;
                amountInput.value = (product.price * quantity).toFixed(2);
                calculateInvoiceTotals();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            if(tabName === 'logs') renderLogs();
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            setTimeout(() => document.body.removeChild(alertDiv), 3000);
        }

        // –ö–ª–∏–µ–Ω—Ç—ã
        function addClient() {
            const name = document.getElementById('clientName').value.trim();
            const mb = document.getElementById('clientMB').value.trim();
            const pib = document.getElementById('clientPIB').value.trim();
            const contact = document.getElementById('clientContact').value.trim();
            const bank = document.getElementById('clientBank').value.trim();
            const isManualInput = document.getElementById('manualAddressInput').checked;
            
            let address, city, municipality, street, houseNumber;
            
            if (isManualInput) {
                // –†—É—á–Ω–æ–π –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞
                address = document.getElementById('clientManualAddress').value.trim();
                
                if (!name || !mb || !pib || !address) { 
                    showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'danger'); 
                    return; 
                }
                
                // –ü–∞—Ä—Å–∏–º –∞–¥—Ä–µ—Å –¥–ª—è –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                const addressParts = address.split(',').map(part => part.trim());
                city = addressParts[0] || '';
                municipality = addressParts[1] || '';
                street = addressParts[2] || '';
                houseNumber = addressParts[3] || '';
                
            } else {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞
                city = document.getElementById('clientCity').value.trim();
                municipality = document.getElementById('clientMunicipality').value.trim();
                street = document.getElementById('clientStreet').value.trim();
                houseNumber = document.getElementById('clientHouseNumber').value.trim();
                
                if (!name || !mb || !pib || !city || !municipality || !street) { 
                    showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'danger'); 
                    return; 
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å
                address = `${city}, ${municipality}, ${street}`;
                if (houseNumber) {
                    address += ` ${houseNumber}`;
                }
            }
            
            const newClient = { 
                name, 
                mb, 
                pib, 
                address, 
                contact, 
                bank, 
                city, 
                municipality, 
                street, 
                houseNumber,
                isManualAddress: isManualInput
            };
            
            clients.push(newClient);
            addLog(`–î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç: ${name}`);
            clearClientForm(); 
            renderClientsTable();
            updateSelectOptions();
            showAlert('–ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        }

        function clearClientForm() {
            ['clientName', 'clientMB', 'clientPIB', 'clientCity', 'clientMunicipality', 'clientStreet', 'clientHouseNumber', 'clientContact', 'clientBank', 'clientManualAddress'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.value = '';
            });
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
            const manualCheckbox = document.getElementById('manualAddressInput');
            if (manualCheckbox) {
                manualCheckbox.checked = false;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥, —Å–∫—Ä—ã–≤–∞–µ–º —Ä—É—á–Ω–æ–π
                document.getElementById('automaticAddressSection').style.display = 'block';
                document.getElementById('manualAddressSection').style.display = 'none';
            }
            
            // –°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª–µ–π –∞–¥—Ä–µ—Å–∞
            const municipalityInput = document.getElementById('clientMunicipality');
            const streetInput = document.getElementById('clientStreet');
            if (municipalityInput) {
                municipalityInput.disabled = true;
                municipalityInput.placeholder = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –≥–æ—Ä–æ–¥...';
            }
            if (streetInput) {
                streetInput.disabled = true;
                streetInput.placeholder = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—â–∏–Ω—É...';
            }
        }

        function deleteClient(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?')) {
                clients.splice(index, 1); 
                renderClientsTable();
                updateSelectOptions();
                showAlert('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω!', 'success');
            }
        }

        function renderClientsTable() {
            const tbody = document.getElementById('clientsTableBody');
            if(!tbody) return;
            tbody.innerHTML = '';
            clients.forEach((client, index) => {
                const row = tbody.insertRow();
                const addressDisplay = client.isManualAddress ? 
                    `<span style="color: #007bff;">üìù</span> ${client.address}` : 
                    client.address;
                    
                row.innerHTML = `
                    <td><strong>${client.name}</strong></td>
                    <td>${client.mb}</td>
                    <td>${client.pib}</td>
                    <td style="max-width: 200px; word-wrap: break-word;">${addressDisplay}</td>
                    <td>${client.contact}</td>
                    <td>${client.bank}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="showClientHistory('${client.name.replace(/'/g, "\\'")}')" style="margin-right: 5px;">–ò—Å—Ç–æ—Ä–∏—è</button>
                        <button class="btn btn-danger" onclick="deleteClient(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
            });
        }

        // –¢–æ–≤–∞—Ä—ã
        function addProduct() {
            const code = document.getElementById('productCode').value.trim();
            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            
            if (!code || !name || !price || price <= 0) { 
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'danger'); 
                return; 
            }
            if (products.find(p => p.code === code)) { 
                showAlert('–ö–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'danger'); 
                return; 
            }
            
            const newProduct = { code, name, price, category };
            products.push(newProduct);
            addLog(`–î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä: ${name} (–∫–æ–¥: ${code})`);
            clearProductForm(); 
            renderProductsTable();
            updateSelectOptions();
            showAlert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        }

        function clearProductForm() {
            ['productCode', 'productName', 'productPrice', 'productCategory'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.value = '';
            });
        }

        function deleteProduct(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
                products.splice(index, 1); 
                renderProductsTable();
                updateSelectOptions();
                showAlert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!', 'success');
            }
        }

        function renderProductsTable() {
            const tbody = document.getElementById('productsTableBody');
            if(!tbody) return;
            tbody.innerHTML = '';
            products.forEach((product, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${product.code}</strong></td>
                    <td>${product.name}</td>
                    <td>${product.price.toFixed(2)} RSD</td>
                    <td>${product.category}</td>
                    <td><button class="btn btn-danger" onclick="deleteProduct(${index})">–£–¥–∞–ª–∏—Ç—å</button></td>
                `;
            });
        }

        // –ò–Ω–≤–æ–π—Å—ã
        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            if(!container) return;

            const newItem = document.createElement('div');
            newItem.className = 'invoice-items';
            
            newItem.innerHTML = `
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–¢–æ–≤–∞—Ä *</label>
                    <div class="searchable-select">
                        <input type="text" class="searchable-input invoice-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." autocomplete="off">
                        <input type="hidden" class="invoice-product" value="">
                        <div class="dropdown-menu invoice-product-dropdown"></div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                    <input type="number" class="invoice-quantity" value="1" min="1">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–¶–µ–Ω–∞ (RSD)</label>
                    <input type="number" class="invoice-price" readonly style="background: #f8f9fa;">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–°—É–º–º–∞ (RSD)</label>
                    <input type="number" class="invoice-amount" readonly style="background: #f8f9fa; font-weight: bold;">
                </div>
                <div style="padding-top: 25px;">
                    <button class="btn btn-danger" onclick="removeInvoiceItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;
            
            container.appendChild(newItem);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
            const newSearch = newItem.querySelector('.invoice-product-search');
            setupProductSearch(newSearch);
            addLog('–î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä –≤ –∏–Ω–≤–æ–π—Å');
        }

        function removeInvoiceItem(button) {
            const container = document.getElementById('invoiceItems');
            if(!container) return;
            
            if (container.children.length > 1) {
                button.closest('.invoice-items').remove();
                calculateInvoiceTotals();
            } else {
                showAlert('–î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä!', 'danger');
            }
        }

        function calculateInvoiceTotals() {
            const amounts = document.querySelectorAll('.invoice-amount');
            let subtotal = 0;
            amounts.forEach(input => subtotal += parseFloat(input.value) || 0);
            
            const vatRate = parseFloat(document.getElementById('invoiceVAT').value) || 0;
            const vatAmount = subtotal * (vatRate / 100);
            const total = subtotal + vatAmount;

            document.getElementById('invoiceSubtotal').textContent = subtotal.toFixed(2) + ' RSD';
            document.getElementById('invoiceVATAmount').textContent = vatAmount.toFixed(2) + ' RSD';
            document.getElementById('invoiceTotal').textContent = total.toFixed(2) + ' RSD';
        }

        function generateInvoice() {
            const invoiceNumber = document.getElementById('invoiceNumber').value.trim();
            const invoiceDate = document.getElementById('invoiceDate').value;
            const invoiceDueDate = document.getElementById('invoiceDueDate').value;
            const clientIndex = document.getElementById('invoiceClient').value;
            const delivery = document.getElementById('invoiceDelivery').value;
            const vatRate = document.getElementById('invoiceVAT').value;

            if (!invoiceNumber || !invoiceDate || !invoiceDueDate || clientIndex === '') {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'danger'); 
                return;
            }

            const items = [];
            const itemRows = document.querySelectorAll('.invoice-items');
            
            itemRows.forEach(row => {
                const hiddenProduct = row.querySelector('.invoice-product');
                const productIndex = hiddenProduct.value;
                const quantity = parseInt(row.querySelector('.invoice-quantity').value);
                const amount = parseFloat(row.querySelector('.invoice-amount').value) || 0;

                if (productIndex !== '' && quantity > 0) {
                    const product = products[productIndex];
                    items.push({
                        product: product,
                        quantity: quantity,
                        price: product.price,
                        amount: amount
                    });
                }
            });

            if (items.length === 0) {
                showAlert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä!', 'danger');
                return;
            }

            const client = clients[clientIndex];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
            let deliveryAddress = client.address;
            const isDifferentAddress = document.getElementById('differentDeliveryAddress').checked;
            
            if (isDifferentAddress) {
                const deliveryCity = document.getElementById('deliveryCity').value.trim();
                const deliveryMunicipality = document.getElementById('deliveryMunicipality').value.trim();
                const deliveryStreet = document.getElementById('deliveryStreet').value.trim();
                const deliveryHouseNumber = document.getElementById('deliveryHouseNumber').value.trim();
                
                if (!deliveryCity || !deliveryMunicipality || !deliveryStreet) {
                    showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏!', 'danger');
                    return;
                }
                
                deliveryAddress = `${deliveryCity}, ${deliveryMunicipality}, ${deliveryStreet}`;
                if (deliveryHouseNumber) {
                    deliveryAddress += ` ${deliveryHouseNumber}`;
                }
            }
            
            const subtotal = items.reduce((sum, item) => sum + item.amount, 0);
            const vatAmount = subtotal * (parseFloat(vatRate) / 100);
            const total = subtotal + vatAmount;

            currentInvoiceData = {
                number: invoiceNumber,
                date: invoiceDate,
                dueDate: invoiceDueDate,
                client: client,
                items: items,
                delivery: delivery,
                deliveryAddress: deliveryAddress,
                isDifferentDeliveryAddress: isDifferentAddress,
                vatRate: parseFloat(vatRate),
                subtotal: subtotal,
                vatAmount: vatAmount,
                total: total
            };

            const invoiceHTML = generateInvoiceHTML(currentInvoiceData);
            document.getElementById('invoiceContent').innerHTML = invoiceHTML;
            document.getElementById('invoicePreview').style.display = 'block';
            document.getElementById('invoicePreview').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('invoiceConfirmMessage').style.display = 'none';
        }

        function generateInvoiceHTML(invoice) {
            let itemsHTML = '';
            invoice.items.forEach(item => {
                itemsHTML += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; font-size: 10px;">${item.product.code}/${item.product.name}</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; text-align: center; font-size: 10px;">${item.quantity}</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; text-align: right; font-size: 10px;">${item.price.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; text-align: right; font-size: 10px; font-weight: bold;">${item.amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                    </tr>
                `;
            });

            return `
                <div style="max-width: 210mm; margin: 0 auto; padding: 10mm; font-family: 'Segoe UI', Arial, sans-serif; background: white; line-height: 1.3; font-size: 12px;">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <img src="https://i.ibb.co/tMCT4jb7/srb-white-verical.png" alt="srb-white-verical" border="0" style="width: 70px; height: auto; border-radius: 10px; background: #000; padding: 8px;">
                            <div>
                                <h2 style="margin: 0; font-size: 15px; color: #333; line-height: 1.2;">–°—Ä–µƒß–∞ 2024 –î–û–û –ë–µ–æ–≥—Ä–∞–¥ (–°—Ç–∞—Ä–∏ –ì—Ä–∞–¥)</h2>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">Matiƒçni broj: 22019309</p>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">PIB: 114407658</p>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">Sedi≈°te: Beograd, Stari Grad, Studentski Trg 4</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <h1 style="margin: 0; font-size: 32px; color: #666; font-weight: 300;">Raƒçun</h1>
                            <p style="margin: 3px 0 0 0; font-size: 13px; color: #666;"># ${invoice.number}</p>
                            <div style="margin-top: 12px;">
                                <p style="margin: 2px 0; font-size: 11px;"><strong>Date:</strong> ${new Date(invoice.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                                <p style="margin: 2px 0; font-size: 11px;"><strong>Due Date:</strong> ${new Date(invoice.dueDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                                <p style="margin: 6px 0 2px 0; font-size: 13px; font-weight: bold; color: #333;"><strong>Balance Due:</strong> ${invoice.total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</p>
                            </div>
                        </div>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ –∏ –¥–æ—Å—Ç–∞–≤–∫–µ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 15px;">
                        <div>
                            <h4 style="margin: 0 0 6px 0; color: #333; font-size: 11px;">Poruƒçioc:</h4>
                            <div style="font-size: 10px; line-height: 1.3;">
                                <p style="margin: 0; font-weight: bold;">${invoice.client.name.split(' ')[0]}</p>
                                <p style="margin: 0; font-weight: bold;">${invoice.client.name.split(' ').slice(1).join(' ')}</p>
                                ${invoice.client.contact && invoice.client.contact.includes('Ugostiteljska') ? '<p style="margin: 0;">Ugostiteljska radnja</p>' : ''}
                                ${invoice.client.contact && invoice.client.contact.includes('Seal') ? '<p style="margin: 0;">Seal</p>' : ''}
                                ${invoice.client.contact && invoice.client.contact.includes('Tea') ? '<p style="margin: 0;">& Tea</p>' : ''}
                                <p style="margin: 0;">${invoice.client.address.split(',')[1] ? invoice.client.address.split(',')[1].trim() : 'Novi Sad'}</p>
                                <p style="margin: 0;">Matiƒçni broj: ${invoice.client.mb}</p>
                                <p style="margin: 0;">PIB: ${invoice.client.pib}</p>
                                <p style="margin: 0;">Sedi≈°te: ${invoice.client.address}</p>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 6px 0; color: #333; font-size: 11px;">Isporuka na adresu::</h4>
                            <p style="margin: 0; font-size: 10px;">${invoice.deliveryAddress || invoice.client.address}</p>
                            <p style="margin: 6px 0 0 0; font-size: 10px;"><strong>Naƒçin:</strong> ${invoice.delivery}</p>
                        </div>
                    </div>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 10px;">
                        <thead>
                            <tr style="background: #333; color: white;">
                                <th style="padding: 6px; text-align: left; font-size: 10px; font-weight: normal;">Proizvod</th>
                                <th style="padding: 6px; text-align: center; font-size: 10px; font-weight: normal;">koliƒçina</th>
                                <th style="padding: 6px; text-align: center; font-size: 10px; font-weight: normal;">cena</th>
                                <th style="padding: 6px; text-align: center; font-size: 10px; font-weight: normal;">iznos</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    
                    <!-- –ò—Ç–æ–≥–∏ -->
                    <div style="text-align: right; margin-bottom: 15px;">
                        <div style="display: inline-block; text-align: right;">
                            <p style="margin: 2px 0; font-size: 12px;"><strong>Subtotal:</strong> ${invoice.subtotal.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</p>
                            <p style="margin: 2px 0; font-size: 12px;"><strong>PDV (${invoice.vatRate}%):</strong> ${invoice.vatAmount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</p>
                            <p style="margin: 6px 0 2px 0; font-size: 14px; font-weight: bold; color: #333;"><strong>Total:</strong> ${invoice.total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</p>
                        </div>
                    </div>
                    
                    <!-- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã -->
                    <div style="margin-top: 15px;">
                        <h4 style="margin: 0 0 4px 0; font-size: 10px;">Podaci o raƒçunima za prijem naknade :</h4>
                        <p style="margin: 1px 0; font-size: 10px;">Broj raƒçuna: 190-0000000085540-29</p>
                        <p style="margin: 1px 0; font-size: 10px;">Kod: Alta Banka ad Beograd</p>
                        <p style="margin: 1px 0; font-size: 10px;">Adresa banke: Beograd, Novi Beograd, Bulevar Zorana ƒêinƒëiƒáa 121</p>
                        <p style="margin: 8px 0 1px 0; font-size: 10px;">Plaƒáanje sa pozivom na broj: ATSNS${invoice.number.replace(/-/g, '')}</p>
                    </div>
                    
                    <style>
                        @media print {
                            @page {
                                size: A4;
                                margin: 10mm;
                            }
                            body {
                                margin: 0;
                                padding: 0;
                            }
                        }
                    </style>
                </div>
            `;
        }

        function confirmInvoice() {
            if (!currentInvoiceData) { 
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–∞!', 'danger'); 
                return; 
            }
            
            if (confirmedInvoices.find(inv => inv.number === currentInvoiceData.number)) { 
                showAlert('–ò–Ω–≤–æ–π—Å —É–∂–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω!', 'danger'); 
                return; 
            }
            
            confirmedInvoices.push({ ...currentInvoiceData, confirmedDate: new Date().toISOString() });
            updateStatistics();
            document.getElementById('invoiceConfirmMessage').style.display = 'block';
            showAlert('–ò–Ω–≤–æ–π—Å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω!', 'success');
        }

        function exportInvoiceToPDF() {
            const invoiceContent = document.getElementById('invoiceContent').innerHTML;
            
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–†–∞—á—É–Ω ${currentInvoiceData.number}</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        body {
                            margin: 0;
                            padding: 0;
                            font-family: 'Segoe UI', Arial, sans-serif;
                        }
                        @media print {
                            body {
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${invoiceContent}
                </body>
                </html>
            `;
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(fullHTML);
                printWindow.document.close();
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—á–∞—Ç—å
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ—Å–ª–µ –ø–µ—á–∞—Ç–∏ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ—Ç–º–µ–Ω–∏–ª)
                        setTimeout(() => {
                            if (!printWindow.closed) {
                                printWindow.close();
                            }
                        }, 1000);
                    }, 500);
                };
            } else {
                // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤, –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –ø–æ–ø–∞–ø—ã
                downloadInvoiceAsHTML();
            }
            
            showAlert('–ò–Ω–≤–æ–π—Å –≥–æ—Ç–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'success');
        }

        function downloadInvoiceAsHTML() {
            const invoiceContent = document.getElementById('invoiceContent').innerHTML;
            
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–†–∞—á—É–Ω ${currentInvoiceData.number}</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        body {
                            margin: 0;
                            padding: 0;
                            font-family: 'Segoe UI', Arial, sans-serif;
                        }
                        @media print {
                            body {
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${invoiceContent}
                </body>
                </html>
            `;
            
            // –°–æ–∑–¥–∞–µ–º blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `Racun_${currentInvoiceData.number.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
            URL.revokeObjectURL(url);
            showAlert('HTML —Ñ–∞–π–ª –∏–Ω–≤–æ–π—Å–∞ —Å–∫–∞—á–∞–Ω!', 'success');
        }

        function copyInvoiceToClipboard() {
            const invoiceContent = document.getElementById('invoiceContent');
            if (!invoiceContent) {
                showAlert('–ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!', 'danger');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = invoiceContent.innerHTML;
            
            // –£–±–∏—Ä–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            const textContent = tempDiv.innerText || tempDiv.textContent;
            
            // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textContent).then(() => {
                    showAlert('–ò–Ω–≤–æ–π—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                    fallbackCopyTextToClipboard(textContent);
                });
            } else {
                fallbackCopyTextToClipboard(textContent);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('–ò–Ω–≤–æ–π—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                } else {
                    showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'danger');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'danger');
            }
            
            document.body.removeChild(textArea);
        }

        function generateDeliveryFromInvoice() {
            const invoiceNumber = document.getElementById('invoiceNumber').value.trim();
            const invoiceDate = document.getElementById('invoiceDate').value;
            const invoiceDueDate = document.getElementById('invoiceDueDate').value;
            const clientIndex = document.getElementById('invoiceClient').value;
            const delivery = document.getElementById('invoiceDelivery').value;

            if (!invoiceNumber || !invoiceDate || !invoiceDueDate || clientIndex === '') {
                showAlert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å–∞!', 'danger');
                return;
            }

            const items = [];
            const itemRows = document.querySelectorAll('.invoice-items');
            
            itemRows.forEach(row => {
                const productIndex = row.querySelector('.invoice-product').value;
                const quantity = parseInt(row.querySelector('.invoice-quantity').value);

                if (productIndex !== '' && quantity > 0) {
                    const product = products[productIndex];
                    items.push({
                        product: product,
                        quantity: quantity
                    });
                }
            });

            if (items.length === 0) {
                showAlert('–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∏–Ω–≤–æ–π—Å!', 'danger');
                return;
            }

            showTab('delivery');
            
            document.getElementById('deliveryNumber').value = invoiceNumber;
            document.getElementById('deliveryDate').value = invoiceDate;
            document.getElementById('deliveryDueDate').value = invoiceDueDate;
            document.getElementById('deliveryClient').value = clientIndex;
            document.getElementById('deliveryMethod').value = delivery;

            const container = document.getElementById('deliveryItems');
            container.innerHTML = '';

            items.forEach((item, index) => {
                const productIndex = products.findIndex(p => p.code === item.product.code);
                
                const newItem = document.createElement('div');
                newItem.className = 'delivery-items';
                newItem.innerHTML = `
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–¢–æ–≤–∞—Ä *</label>
                        <div class="searchable-select">
                            <input type="text" class="searchable-input delivery-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." value="${item.product.code} - ${item.product.name}" autocomplete="off">
                            <input type="hidden" class="delivery-product" value="${productIndex}">
                            <div class="dropdown-menu delivery-product-dropdown"></div>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" class="delivery-quantity" value="${item.quantity}" min="1">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>–ï–¥–∏–Ω–∏—Ü–∞</label>
                        <input type="text" class="delivery-unit" value="–∫–æ–º" readonly>
                    </div>
                    <div style="padding-top: 25px;">
                        <button class="btn btn-danger" onclick="removeDeliveryItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                container.appendChild(newItem);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
                const newSearch = newItem.querySelector('.delivery-product-search');
                setupProductSearch(newSearch);
            });

            showAlert('–î–∞–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É!', 'success');
        }

        // –û—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã
        function addDeliveryItem() {
            const container = document.getElementById('deliveryItems');
            if(!container) return;

            const newItem = document.createElement('div');
            newItem.className = 'delivery-items';
            
            newItem.innerHTML = `
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–¢–æ–≤–∞—Ä *</label>
                    <div class="searchable-select">
                        <input type="text" class="searchable-input delivery-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." autocomplete="off">
                        <input type="hidden" class="delivery-product" value="">
                        <div class="dropdown-menu delivery-product-dropdown"></div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                    <input type="number" class="delivery-quantity" value="1" min="1">
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>–ï–¥–∏–Ω–∏—Ü–∞</label>
                    <input type="text" class="delivery-unit" value="–∫–æ–º" readonly>
                </div>
                <div style="padding-top: 25px;">
                    <button class="btn btn-danger" onclick="removeDeliveryItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;
            
            container.appendChild(newItem);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
            const newSearch = newItem.querySelector('.delivery-product-search');
            setupProductSearch(newSearch);
            addLog('–î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä –≤ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É');
        }

        function removeDeliveryItem(button) {
            const container = document.getElementById('deliveryItems');
            if(!container) return;
            
            if (container.children.length > 1) {
                button.closest('.delivery-items').remove();
            } else {
                showAlert('–î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä!', 'danger');
            }
        }

        function generateDelivery() {
            const deliveryNumber = document.getElementById('deliveryNumber').value.trim();
            const deliveryDate = document.getElementById('deliveryDate').value;
            const deliveryDueDate = document.getElementById('deliveryDueDate').value;
            const clientIndex = document.getElementById('deliveryClient').value;
            const method = document.getElementById('deliveryMethod').value;

            if (!deliveryNumber || !deliveryDate || !deliveryDueDate || clientIndex === '') {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'danger');
                return;
            }

            const items = [];
            const itemRows = document.querySelectorAll('.delivery-items');
            
            itemRows.forEach(row => {
                const hiddenProduct = row.querySelector('.delivery-product');
                const productIndex = hiddenProduct.value;
                const quantity = parseInt(row.querySelector('.delivery-quantity').value);
                const unit = row.querySelector('.delivery-unit').value;

                if (productIndex !== '' && quantity > 0) {
                    const product = products[productIndex];
                    items.push({
                        product: product,
                        quantity: quantity,
                        unit: unit
                    });
                }
            });

            if (items.length === 0) {
                showAlert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä!', 'danger');
                return;
            }

            const client = clients[clientIndex];

            let itemsHTML = '';
            items.forEach(item => {
                itemsHTML += `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; font-size: 10px;">${item.product.code}/${item.product.name}</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; text-align: center; font-size: 10px;">${item.quantity}</td>
                        <td style="padding: 4px 6px; border-bottom: 1px solid #eee; text-align: center; font-size: 10px;">${item.unit}</td>
                    </tr>
                `;
            });

            const deliveryHTML = `
                <div style="max-width: 210mm; margin: 0 auto; padding: 10mm; font-family: 'Segoe UI', Arial, sans-serif; background: white; line-height: 1.3; font-size: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <img src="https://i.ibb.co/tMCT4jb7/srb-white-verical.png" alt="srb-white-verical" border="0" style="width: 70px; height: auto; border-radius: 10px; background: #000; padding: 8px;">
                            <div>
                                <h2 style="margin: 0; font-size: 15px; color: #333; line-height: 1.2;">–°—Ä–µƒß–∞ 2024 –î–û–û –ë–µ–æ–≥—Ä–∞–¥ (–°—Ç–∞—Ä–∏ –ì—Ä–∞–¥)</h2>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">Matiƒçni broj: 22019309</p>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">PIB: 114407658</p>
                                <p style="margin: 1px 0; color: #666; font-size: 10px;">Sedi≈°te: Beograd, Stari Grad, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <h1 style="margin: 0; font-size: 32px; color: #666; font-weight: 300;">–û–¢–ü–†–ï–ú–ù–ò–¶–ê</h1>
                            <p style="margin: 3px 0 0 0; font-size: 13px; color: #666;"># ${deliveryNumber}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 15px;">
                        <div>
                            <h4 style="margin: 0 0 6px 0; color: #333; font-size: 11px;">–ü–æ—Ä—É—á–∏–ª–∞—Ü:</h4>
                            <div style="font-size: 10px; line-height: 1.3;">
                                <p style="margin: 0; font-weight: bold;">${client.name}</p>
                                <p style="margin: 0;">Matiƒçni broj: ${client.mb}</p>
                                <p style="margin: 0;">PIB: ${client.pib}</p>
                                <p style="margin: 0;">Sedi≈°te: ${client.address}</p>
                            </div>
                        </div>
                        <div>
                            <h4 style="margin: 0 0 6px 0; color: #333; font-size: 11px;">–ò—Å–ø–æ—Ä—É–∫–∞ –Ω–∞ –∞–¥—Ä–µ—Å—É:</h4>
                            <p style="margin: 0; font-size: 10px;">${client.address}</p>
                            <p style="margin: 6px 0 0 0; font-size: 10px;"><strong>–ù–∞—á–∏–Ω:</strong> ${method}</p>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <p style="margin: 2px 0; font-size: 10px;"><strong>–î–∞—Ç–∞:</strong> ${new Date(deliveryDate).toLocaleDateString('sr-RS')}</p>
                        <p style="margin: 2px 0; font-size: 10px;"><strong>–†–æ–∫ –∏—Å–ø–æ—Ä—É–∫–µ:</strong> ${new Date(deliveryDueDate).toLocaleDateString('sr-RS')}</p>
                    </div>

                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 10px;">
                        <thead>
                            <tr style="background: #333; color: white;">
                                <th style="padding: 6px; text-align: left; font-size: 10px; font-weight: normal;">–ù–∞–∑–∏–≤ –∞—Ä—Ç–∏–∫–ª–∞</th>
                                <th style="padding: 6px; text-align: center; font-size: 10px; font-weight: normal;">–ö–æ–ª–∏—á–∏–Ω–∞</th>
                                <th style="padding: 6px; text-align: center; font-size: 10px; font-weight: normal;">–à–µ–¥–∏–Ω–∏—Ü–∞ –º–µ—Ä–µ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <div style="text-align: center;">
                            <div style="border-bottom: 2px solid #333; margin-bottom: 6px; height: 25px;"></div>
                            <div style="font-size: 10px;"><strong>–ò–∑–¥–∞–æ</strong></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-bottom: 2px solid #333; margin-bottom: 6px; height: 25px;"></div>
                            <div style="font-size: 10px;"><strong>–ü—Ä–∏–º–∏–æ</strong></div>
                        </div>
                    </div>

                    <div style="margin-top: 15px; text-align: center; font-size: 9px; color: #666;">
                        –û–≤–∞—ò –¥–æ–∫—É–º–µ–Ω—Ç —ò–µ –≥–µ–Ω–µ—Ä–∏—Å–∞–Ω –µ–ª–µ–∫—Ç—Ä–æ–Ω—Å–∫–∏ –∏ –≤–∞–∂–∏ –±–µ–∑ –ø–µ—á–∞—Ç–∞ –∏ –ø–æ—Ç–ø–∏—Å–∞
                    </div>
                </div>
            `;

            document.getElementById('deliveryContent').innerHTML = deliveryHTML;
            document.getElementById('deliveryPreview').style.display = 'block';
            document.getElementById('deliveryPreview').scrollIntoView({ behavior: 'smooth' });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            window.currentDeliveryData = {
                number: deliveryNumber,
                date: deliveryDate,
                dueDate: deliveryDueDate,
                client: client,
                method: method,
                items: items,
                signed: false
            };
        }

        function confirmDelivery() {
            if (!window.currentDeliveryData) {
                showAlert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É!', 'danger');
                return;
            }
            
            confirmedDeliveries.push(window.currentDeliveryData);
            localStorage.setItem('confirmedDeliveries', JSON.stringify(confirmedDeliveries));
            
            updateDeliveriesList();
            updateDeliveryClientFilter();
            
            addLog(`–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ #${window.currentDeliveryData.number} –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ ${window.currentDeliveryData.client.name}`);
            showAlert('–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫!', 'success');
            
            window.currentDeliveryData = null;
        }

        function printDelivery() {
            const deliveryContent = document.getElementById('deliveryContent').innerHTML;
            const deliveryNumber = document.getElementById('deliveryNumber').value;
            
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ ${deliveryNumber}</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        body {
                            margin: 0;
                            padding: 0;
                            font-family: 'Segoe UI', Arial, sans-serif;
                        }
                        @media print {
                            body {
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${deliveryContent}
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(fullHTML);
                printWindow.document.close();
                
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                        setTimeout(() => {
                            if (!printWindow.closed) {
                                printWindow.close();
                            }
                        }, 1000);
                    }, 500);
                };
            } else {
                // Fallback - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ HTML —Ñ–∞–π–ª–∞
                const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `Otpremnica_${deliveryNumber.replace(/[^a-zA-Z0-9]/g, '_')}.html`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
            }
            
            showAlert('–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'success');
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function initializeStatistics() {
            const today = new Date();
            const firstDayOfYear = new Date(today.getFullYear(), 0, 1);
            
            document.getElementById('statsFromDate').value = firstDayOfYear.toISOString().split('T')[0];
            document.getElementById('statsToDate').value = today.toISOString().split('T')[0];
            
            updateStatistics();
        }

        let currentFilteredInvoices = []; // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤

        function updateStatistics() {
            const fromDate = new Date(document.getElementById('statsFromDate').value);
            const toDate = new Date(document.getElementById('statsToDate').value);
            toDate.setHours(23, 59, 59, 999);
            
            const filteredInvoices = confirmedInvoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                return invoiceDate >= fromDate && invoiceDate <= toDate;
            });

            currentFilteredInvoices = filteredInvoices; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø–æ–∏—Å–∫–∞

            const totalRevenue = filteredInvoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalInvoicesCount = filteredInvoices.length;
            const uniqueClients = new Set(filteredInvoices.map(inv => inv.client.name)).size;
            const averageOrder = totalInvoicesCount > 0 ? totalRevenue / totalInvoicesCount : 0;

            document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2) + ' RSD';
            document.getElementById('totalInvoices').textContent = totalInvoicesCount;
            document.getElementById('totalClients').textContent = uniqueClients;
            document.getElementById('averageOrder').textContent = averageOrder.toFixed(2) + ' RSD';

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('invoiceSearchInput').value = '';
            
            updateInvoicesList(filteredInvoices);
            updateRevenueChart(filteredInvoices);
            updateProductsChart(filteredInvoices);
            updateClientsChart(filteredInvoices);
        }

        function filterInvoicesBySearch() {
            const searchTerm = document.getElementById('invoiceSearchInput').value.trim().toLowerCase();
            
            if (!searchTerm) {
                // –ï—Å–ª–∏ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∏–Ω–≤–æ–π—Å—ã –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
                updateInvoicesList(currentFilteredInvoices);
                return;
            }

            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏–Ω–≤–æ–π—Å—ã –ø–æ –Ω–æ–º–µ—Ä—É
            const searchResults = currentFilteredInvoices.filter(invoice => 
                invoice.number.toLowerCase().includes(searchTerm)
            );

            updateInvoicesList(searchResults);
        }

        function updateRevenueChart(invoices) {
            const chartEl = document.getElementById('revenueChart');
            if(!chartEl) return;

            if (invoices.length === 0) {
                chartEl.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            const monthlyData = {};
            invoices.forEach(invoice => {
                const date = new Date(invoice.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + invoice.total;
            });

            let chartHTML = '<div style="display: flex; align-items: end; height: 200px; gap: 10px; padding: 20px;">';
            const maxValue = Math.max(...Object.values(monthlyData));
            const months = ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'];
            
            Object.entries(monthlyData).forEach(([monthKey, value]) => {
                const [year, month] = monthKey.split('-');
                const monthName = months[parseInt(month) - 1];
                const height = (value / maxValue) * 150;
                chartHTML += `
                    <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                        <div style="font-size: 12px; margin-bottom: 5px; font-weight: bold;">${value.toFixed(0)} RSD</div>
                        <div style="width: 40px; height: ${height}px; background: linear-gradient(to top, #212529, #343a40); border-radius: 4px 4px 0 0;"></div>
                        <div style="font-size: 12px; margin-top: 5px; text-align: center;">${monthName}<br>${year}</div>
                    </div>
                `;
            });
            chartHTML += '</div>';
            chartEl.innerHTML = chartHTML;
        }

        function updateProductsChart(invoices) {
            const chartEl = document.getElementById('productsChart');
            if(!chartEl) return;

            const productData = {};
            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    const key = item.product.code;
                    if (!productData[key]) {
                        productData[key] = {
                            name: item.product.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productData[key].quantity += item.quantity;
                    productData[key].revenue += item.amount;
                });
            });

            const sortedProducts = Object.entries(productData)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 10);

            if (sortedProducts.length === 0) {
                chartEl.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            const maxRevenue = sortedProducts[0][1].revenue;
            let chartHTML = '<div style="padding: 20px;">';
            
            sortedProducts.forEach(([code, data]) => {
                const percentage = (data.revenue / maxRevenue) * 100;
                chartHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: bold; font-size: 14px;">${code}</span>
                            <span style="font-size: 14px;">${data.revenue.toFixed(2)} RSD (${data.quantity} —à—Ç)</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px;">
                            <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #28a745, #20c997); border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            });
            chartHTML += '</div>';
            chartEl.innerHTML = chartHTML;
        }

        function updateClientsChart(invoices) {
            const chartEl = document.getElementById('clientsChart');
            if(!chartEl) return;

            const clientData = {};
            invoices.forEach(invoice => {
                const clientName = invoice.client.name;
                clientData[clientName] = (clientData[clientName] || 0) + invoice.total;
            });

            const sortedClients = Object.entries(clientData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            if (sortedClients.length === 0) {
                chartEl.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>';
                return;
            }

            const maxRevenue = sortedClients[0][1];
            let chartHTML = '<div style="padding: 20px;">';
            
            sortedClients.forEach(([clientName, revenue]) => {
                const percentage = (revenue / maxRevenue) * 100;
                chartHTML += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: bold; font-size: 14px;">${clientName}</span>
                            <span style="font-size: 14px;">${revenue.toFixed(2)} RSD</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: #e9ecef; border-radius: 4px;">
                            <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #212529, #343a40); border-radius: 4px;"></div>
                        </div>
                    </div>
                `;
            });
            chartHTML += '</div>';
            chartEl.innerHTML = chartHTML;
        }

        function updateInvoicesList(invoices) {
            const container = document.getElementById('confirmedInvoicesList');
            if(!container) return;

            if (invoices.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">–ù–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>';
                return;
            }

            let listHTML = '';
            invoices.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((invoice, index) => {
                const date = new Date(invoice.date).toLocaleDateString('sr-RS');
                const originalIndex = confirmedInvoices.findIndex(inv => inv.number === invoice.number);
                const isDelivered = invoice.delivered || false;
                const isPaid = invoice.paid || false;
                
                listHTML += `
                    <div class="invoice-item">
                        <div class="invoice-info">
                            <div style="font-weight: bold; color: #212529;">–ò–Ω–≤–æ–π—Å #${invoice.number}</div>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">${invoice.client.name} ‚Ä¢ ${date} ‚Ä¢ ${invoice.total.toFixed(2)} RSD</div>
                            <div style="font-size: 12px; color: #888; margin-top: 3px;">–¢–æ–≤–∞—Ä–æ–≤: ${invoice.items.length} ‚Ä¢ –ù–î–°: ${invoice.vatRate}%</div>
                            <div style="margin-top: 10px; display: flex; gap: 15px;">
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                                    <input type="checkbox" ${isDelivered ? 'checked' : ''} onchange="toggleInvoiceStatus('${invoice.number}', 'delivered', this.checked)" style="transform: scale(1.2);">
                                    <span style="color: ${isDelivered ? '#28a745' : '#6c757d'};">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                                    <input type="checkbox" ${isPaid ? 'checked' : ''} onchange="toggleInvoiceStatus('${invoice.number}', 'paid', this.checked)" style="transform: scale(1.2);">
                                    <span style="color: ${isPaid ? '#28a745' : '#6c757d'};">–û–ø–ª–∞—á–µ–Ω</span>
                                </label>
                            </div>
                        </div>
                        <div class="invoice-actions">
                            <button class="btn btn-secondary" onclick="viewConfirmedInvoice(${originalIndex})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω–≤–æ–π—Å">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                            <button class="btn btn-success" onclick="copyInvoiceData(${originalIndex})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—ã–π –∏–Ω–≤–æ–π—Å">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            <span class="invoice-status">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                            <button class="btn btn-danger" onclick="removeInvoiceFromStats('${invoice.number}')">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = listHTML;
        }

        function toggleInvoiceStatus(invoiceNumber, statusType, isChecked) {
            const invoice = confirmedInvoices.find(inv => inv.number === invoiceNumber);
            if (invoice) {
                if (statusType === 'delivered') {
                    invoice.delivered = isChecked;
                    addLog(`–ò–Ω–≤–æ–π—Å #${invoiceNumber} –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ ${isChecked ? '–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π' : '–Ω–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π'}`);
                } else if (statusType === 'paid') {
                    invoice.paid = isChecked;
                    addLog(`–ò–Ω–≤–æ–π—Å #${invoiceNumber} –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ ${isChecked ? '–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π' : '–Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–π'}`);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                localStorage.setItem('confirmedInvoices', JSON.stringify(confirmedInvoices));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞
                updateStatistics();
            }
        }

        function removeInvoiceFromStats(invoiceNumber) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∏–Ω–≤–æ–π—Å –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏?')) {
                confirmedInvoices = confirmedInvoices.filter(inv => inv.number !== invoiceNumber);
                updateStatistics();
                addLog(`–ò–Ω–≤–æ–π—Å #${invoiceNumber} —É–¥–∞–ª–µ–Ω –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏`);
                showAlert('–ò–Ω–≤–æ–π—Å —É–¥–∞–ª–µ–Ω –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏!', 'success');
            }
        }

        function viewConfirmedInvoice(invoiceIndex) {
            const invoice = confirmedInvoices[invoiceIndex];
            if (!invoice) {
                showAlert('–ò–Ω–≤–æ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'danger');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            const modalHTML = `
                <div id="invoiceViewModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 15px; max-width: 90%; max-height: 90%; overflow: auto; position: relative;">
                        <div style="position: sticky; top: 0; background: white; padding: 20px; border-bottom: 2px solid #e9ecef; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0; color: #212529;">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω–≤–æ–π—Å–∞ #${invoice.number}</h3>
                            <div>
                                <button class="btn btn-primary" onclick="exportModalInvoiceToPDF()">–≠–∫—Å–ø–æ—Ä—Ç PDF</button>
                                <button class="btn btn-success" onclick="copyInvoiceData(${invoiceIndex})">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                                <button class="btn btn-danger" onclick="closeInvoiceViewModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                        <div id="modalInvoiceContent" style="padding: 20px;">
                            ${generateInvoiceHTML(invoice)}
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
            window.currentModalInvoice = invoice;
        }

        function closeInvoiceViewModal() {
            const modal = document.getElementById('invoiceViewModal');
            if (modal) {
                modal.remove();
            }
            window.currentModalInvoice = null;
        }

        function exportModalInvoiceToPDF() {
            if (!window.currentModalInvoice) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'danger');
                return;
            }

            const invoice = window.currentModalInvoice;
            const invoiceContent = generateInvoiceHTML(invoice);
            
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–†–∞—á—É–Ω ${invoice.number}</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 15mm;
                        }
                        body {
                            margin: 0;
                            padding: 0;
                            font-family: 'Segoe UI', Arial, sans-serif;
                        }
                        @media print {
                            body {
                                -webkit-print-color-adjust: exact;
                                print-color-adjust: exact;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${invoiceContent}
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(fullHTML);
                printWindow.document.close();
                
                printWindow.onload = function() {
                    setTimeout(() => {
                        printWindow.print();
                        setTimeout(() => {
                            if (!printWindow.closed) {
                                printWindow.close();
                            }
                        }, 1000);
                    }, 500);
                };
            }
            
            showAlert('–ò–Ω–≤–æ–π—Å –≥–æ—Ç–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'success');
        }

        function copyInvoiceData(invoiceIndex) {
            const invoice = confirmedInvoices[invoiceIndex];
            if (!invoice) {
                showAlert('–ò–Ω–≤–æ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'danger');
                return;
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–∞
            showTab('invoice');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
            closeInvoiceViewModal();

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä –∏–Ω–≤–æ–π—Å–∞
            const today = new Date();
            const dateStr = `${String(today.getDate()).padStart(2, '0')}${String(today.getMonth() + 1).padStart(2, '0')}${today.getFullYear()}`;
            const newInvoiceNumber = `${confirmedInvoices.length + 1}-${dateStr}`;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º –∏ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π)
            document.getElementById('invoiceNumber').value = newInvoiceNumber;
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('invoiceDueDate').value = nextWeek.toISOString().split('T')[0];

            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∫–ª–∏–µ–Ω—Ç–∞
            const clientIndex = clients.findIndex(c => c.name === invoice.client.name && c.mb === invoice.client.mb);
            if (clientIndex !== -1) {
                document.getElementById('invoiceClientSearch').value = invoice.client.name;
                document.getElementById('invoiceClient').value = clientIndex;
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –ù–î–°
            document.getElementById('invoiceDelivery').value = invoice.delivery;
            document.getElementById('invoiceVAT').value = invoice.vatRate;

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –µ—Å–ª–∏ –æ–Ω –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
            if (invoice.isDifferentDeliveryAddress) {
                document.getElementById('differentDeliveryAddress').checked = true;
                document.getElementById('deliveryAddressSection').style.display = 'block';
                
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
                // –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ invoice
            }

            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ç–æ–≤–∞—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –∏–Ω–≤–æ–π—Å–∞
            const container = document.getElementById('invoiceItems');
            container.innerHTML = '';

            invoice.items.forEach((item, index) => {
                const productIndex = products.findIndex(p => p.code === item.product.code);
                
                if (productIndex !== -1) {
                    const newItem = document.createElement('div');
                    newItem.className = 'invoice-items';
                    newItem.innerHTML = `
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–¢–æ–≤–∞—Ä *</label>
                            <div class="searchable-select">
                                <input type="text" class="searchable-input invoice-product-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." value="${item.product.code} - ${item.product.name}" autocomplete="off">
                                <input type="hidden" class="invoice-product" value="${productIndex}">
                                <div class="dropdown-menu invoice-product-dropdown"></div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                            <input type="number" class="invoice-quantity" value="${item.quantity}" min="1">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–¶–µ–Ω–∞ (RSD)</label>
                            <input type="number" class="invoice-price" value="${item.price.toFixed(2)}" readonly style="background: #f8f9fa;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label>–°—É–º–º–∞ (RSD)</label>
                            <input type="number" class="invoice-amount" value="${item.amount.toFixed(2)}" readonly style="background: #f8f9fa; font-weight: bold;">
                        </div>
                        <div style="padding-top: 25px;">
                            <button class="btn btn-danger" onclick="removeInvoiceItem(this)">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                    container.appendChild(newItem);
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
                    const newSearch = newItem.querySelector('.invoice-product-search');
                    setupProductSearch(newSearch);
                }
            });

            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–∏
            calculateInvoiceTotals();

            showAlert('–î–∞–Ω–Ω—ã–µ –∏–Ω–≤–æ–π—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã! –û–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç–∞.', 'success');
        }

        function exportStatisticsToPDF() {
            const fromDate = document.getElementById('statsFromDate').value;
            const toDate = document.getElementById('statsToDate').value;
            
            if (!fromDate || !toDate) { 
                showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥!', 'danger'); 
                return; 
            }
            
            const filteredInvoices = confirmedInvoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                const from = new Date(fromDate);
                const to = new Date(toDate);
                to.setHours(23, 59, 59, 999);
                return invoiceDate >= from && invoiceDate <= to;
            });

            if (filteredInvoices.length === 0) { 
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'danger'); 
                return; 
            }
            
            const reportContent = generatePDFReport(filteredInvoices, fromDate, toDate);
            
            const printWindow = window.open('', '_blank');
            if(printWindow) {
                printWindow.document.write(reportContent);
                printWindow.document.close();
                setTimeout(() => { printWindow.print(); }, 500);
            }
            
            showAlert('PDF –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é!', 'success');
        }

        function generatePDFReport(invoices, fromDate, toDate) {
            const totalRevenue = invoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalInvoicesCount = invoices.length;
            const uniqueClients = new Set(invoices.map(inv => inv.client.name)).size;
            const averageOrder = totalInvoicesCount > 0 ? totalRevenue / totalInvoicesCount : 0;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
            const productData = {};
            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    const key = item.product.code;
                    if (!productData[key]) {
                        productData[key] = {
                            name: item.product.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productData[key].quantity += item.quantity;
                    productData[key].revenue += item.amount;
                });
            });

            const topProducts = Object.entries(productData)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 10);

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
            const clientData = {};
            invoices.forEach(invoice => {
                const clientName = invoice.client.name;
                clientData[clientName] = (clientData[clientName] || 0) + invoice.total;
            });

            const topClients = Object.entries(clientData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
            const monthlyData = {};
            invoices.forEach(invoice => {
                const date = new Date(invoice.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + invoice.total;
            });

            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('sr-RS');
            };

            const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –≤—ã—Ä—É—á–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º (—Ç–µ–∫—Å—Ç–æ–≤–∞—è)
            let monthlyChartHTML = '';
            if (Object.keys(monthlyData).length > 0) {
                const maxValue = Math.max(...Object.values(monthlyData));
                Object.entries(monthlyData).forEach(([monthKey, value]) => {
                    const [year, month] = monthKey.split('-');
                    const monthName = months[parseInt(month) - 1];
                    const percentage = (value / maxValue) * 100;
                    monthlyChartHTML += `
                        <tr>
                            <td style="padding: 6px; border: 1px solid #ddd;">${monthName} ${year}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">${value.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                            <td style="padding: 6px; border: 1px solid #ddd;">
                                <div style="background: #e9ecef; height: 20px; border-radius: 3px;">
                                    <div style="background: linear-gradient(to right, #212529, #343a40); height: 100%; width: ${percentage}%; border-radius: 3px;"></div>
                                </div>
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${((value / totalRevenue) * 100).toFixed(1)}%</td>
                        </tr>
                    `;
                });
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã —Ç–æ–≤–∞—Ä–æ–≤
            let productsChartHTML = '';
            if (topProducts.length > 0) {
                const maxRevenue = topProducts[0][1].revenue;
                topProducts.forEach(([code, data]) => {
                    const percentage = (data.revenue / maxRevenue) * 100;
                    const revenuePercentage = ((data.revenue / totalRevenue) * 100).toFixed(1);
                    productsChartHTML += `
                        <tr>
                            <td style="padding: 6px; border: 1px solid #ddd;"><strong>${code}</strong></td>
                            <td style="padding: 6px; border: 1px solid #ddd;">${data.name}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${data.quantity}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">${data.revenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                            <td style="padding: 6px; border: 1px solid #ddd;">
                                <div style="background: #e9ecef; height: 15px; border-radius: 3px;">
                                    <div style="background: linear-gradient(to right, #28a745, #20c997); height: 100%; width: ${percentage}%; border-radius: 3px;"></div>
                                </div>
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${revenuePercentage}%</td>
                        </tr>
                    `;
                });
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
            let clientsChartHTML = '';
            if (topClients.length > 0) {
                const maxRevenue = topClients[0][1];
                topClients.forEach(([clientName, revenue]) => {
                    const percentage = (revenue / maxRevenue) * 100;
                    const revenuePercentage = ((revenue / totalRevenue) * 100).toFixed(1);
                    const orderCount = invoices.filter(inv => inv.client.name === clientName).length;
                    clientsChartHTML += `
                        <tr>
                            <td style="padding: 6px; border: 1px solid #ddd;"><strong>${clientName}</strong></td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">${revenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${orderCount}</td>
                            <td style="padding: 6px; border: 1px solid #ddd;">
                                <div style="background: #e9ecef; height: 15px; border-radius: 3px;">
                                    <div style="background: linear-gradient(to right, #212529, #343a40); height: 100%; width: ${percentage}%; border-radius: 3px;"></div>
                                </div>
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${revenuePercentage}%</td>
                        </tr>
                    `;
                });
            }

            let invoicesListHTML = '';
            invoices.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(invoice => {
                const date = new Date(invoice.date).toLocaleDateString('sr-RS');
                invoicesListHTML += `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 6px; border: 1px solid #ddd;"><strong>${invoice.number}</strong></td>
                        <td style="padding: 6px; border: 1px solid #ddd;">${date}</td>
                        <td style="padding: 6px; border: 1px solid #ddd;">${invoice.client.name}</td>
                        <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${invoice.items.length}</td>
                        <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">${invoice.total.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</td>
                        <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${invoice.vatRate}%</td>
                    </tr>
                `;
            });

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</title>
                    <style>
                        @page { size: A4; margin: 15mm; }
                        body { font-family: Arial, sans-serif; margin: 0; padding: 0; font-size: 11px; line-height: 1.3; }
                        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #212529; padding-bottom: 15px; }
                        .logo { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 15px; }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; page-break-inside: avoid; }
                        th { background: #212529; color: white; padding: 8px; text-align: left; font-size: 10px; }
                        td { border: 1px solid #ddd; padding: 6px; font-size: 10px; }
                        tr:nth-child(even) { background: #f9f9f9; }
                        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
                        .stat-box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px; text-align: center; border-left: 3px solid #212529; }
                        .stat-number { font-size: 16px; font-weight: bold; color: #212529; margin-bottom: 3px; }
                        .stat-label { font-size: 9px; color: #666; }
                        h2 { color: #212529; border-bottom: 1px solid #212529; padding-bottom: 5px; margin: 20px 0 10px 0; font-size: 14px; }
                        h3 { color: #212529; margin: 15px 0 8px 0; font-size: 12px; }
                        .section { page-break-inside: avoid; margin-bottom: 20px; }
                        .footer { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid #212529; color: #666; font-size: 9px; }
                    </style>
                </head>
                <body>
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
                    <div class="header">
                        <div class="logo">
                            <img src="https://i.ibb.co/tMCT4jb7/srb-white-verical.png" alt="–°—Ä–µƒß–∞ 2024 –î–û–û" style="width: 60px; height: auto; background: #000; border-radius: 8px; padding: 6px;">
                            <div style="text-align: left;">
                                <h1 style="margin: 0; color: #212529; font-size: 18px;">–°—Ä–µƒß–∞ 2024 –î–û–û</h1>
                                <p style="margin: 2px 0; color: #666; font-size: 10px;">–ë–µ–æ–≥—Ä–∞–¥, –°—Ç–∞—Ä–∏ –ì—Ä–∞–¥, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35</p>
                                <p style="margin: 2px 0; color: #666; font-size: 10px;">–ú–ë: 22019309 | –ü–ò–ë: 114407658</p>
                            </div>
                        </div>
                        <h2 style="margin: 10px 0 5px 0; font-size: 16px; border: none;">–û–¢–ß–ï–¢ –ü–û –ü–†–û–î–ê–ñ–ê–ú</h2>
                        <p style="margin: 0; color: #666; font-size: 11px;">
                            –ü–µ—Ä–∏–æ–¥: ${formatDate(fromDate)} - ${formatDate(toDate)} | 
                            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${new Date().toLocaleDateString('sr-RS')} –≤ ${new Date().toLocaleTimeString('sr-RS')}
                        </p>
                    </div>

                    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="section">
                        <h2>–ö–õ–Æ–ß–ï–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò</h2>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-number">${totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</div>
                                <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">${totalInvoicesCount}</div>
                                <div class="stat-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–≤–æ–π—Å–æ–≤</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">${uniqueClients}</div>
                                <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number">${averageOrder.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</div>
                                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑</div>
                            </div>
                        </div>
                    </div>

                    <!-- –í—ã—Ä—É—á–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º -->
                    ${Object.keys(monthlyData).length > 0 ? `
                    <div class="section">
                        <h2>–í–´–†–£–ß–ö–ê –ü–û –ú–ï–°–Ø–¶–ê–ú</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>–ú–µ—Å—è—Ü</th>
                                    <th>–í—ã—Ä—É—á–∫–∞</th>
                                    <th>–î–∏–∞–≥—Ä–∞–º–º–∞</th>
                                    <th>% –æ—Ç –æ–±—â–µ–π</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${monthlyChartHTML}
                            </tbody>
                        </table>
                    </div>
                    ` : ''}

                    <!-- –¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ -->
                    ${topProducts.length > 0 ? `
                    <div class="section">
                        <h2>–¢–û–ü –¢–û–í–ê–†–û–í –ü–û –ü–†–û–î–ê–ñ–ê–ú</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>–ö–æ–¥</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–ö–æ–ª-–≤–æ</th>
                                    <th>–í—ã—Ä—É—á–∫–∞</th>
                                    <th>–î–∏–∞–≥—Ä–∞–º–º–∞</th>
                                    <th>% –æ—Ç –æ–±—â–µ–π</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productsChartHTML}
                            </tbody>
                        </table>
                    </div>
                    ` : ''}

                    <!-- –¢–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                    ${topClients.length > 0 ? `
                    <div class="section">
                        <h2>–¢–û–ü –ö–õ–ò–ï–ù–¢–û–í –ü–û –í–´–†–£–ß–ö–ï</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>–í—ã—Ä—É—á–∫–∞</th>
                                    <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                    <th>–î–∏–∞–≥—Ä–∞–º–º–∞</th>
                                    <th>% –æ—Ç –æ–±—â–µ–π</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${clientsChartHTML}
                            </tbody>
                        </table>
                    </div>
                    ` : ''}

                    <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ -->
                    <div class="section">
                        <h2>–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û –ò–ù–í–û–ô–°–ê–ú</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>‚Ññ –ò–Ω–≤–æ–π—Å–∞</th>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>–¢–æ–≤–∞—Ä–æ–≤</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–ù–î–°</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${invoicesListHTML}
                            </tbody>
                        </table>
                    </div>

                    <!-- –ü–æ–¥–≤–∞–ª -->
                    <div class="footer">
                        <p><strong>–°—Ä–µƒß–∞ 2024 –î–û–û</strong> | –ë–µ–æ–≥—Ä–∞–¥, –°—Ç–∞—Ä–∏ –ì—Ä–∞–¥, –ú–∞—ò–∫–µ –à–µ–≤—Ä–æ—Å–∏–º–µ 35 | –ú–ë: 22019309 | –ü–ò–ë: 114407658</p>
                        <p>–≠—Ç–æ—Ç –æ—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç ${totalInvoicesCount} –∏–Ω–≤–æ–π—Å–æ–≤ –Ω–∞ –æ–±—â—É—é —Å—É–º–º—É ${totalRevenue.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ' ')} RSD</p>
                    </div>
                </body>
                </html>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('invoice-quantity')) {
                const row = e.target.closest('.invoice-items');
                const hiddenProduct = row.querySelector('.invoice-product');
                const productIndex = hiddenProduct.value;
                
                if (productIndex !== '') {
                    const product = products[productIndex];
                    const quantity = parseInt(e.target.value) || 1;
                    const amountInput = row.querySelector('.invoice-amount');
                    amountInput.value = (product.price * quantity).toFixed(2);
                }
                calculateInvoiceTotals();
            }

            if (e.target.id === 'invoiceVAT') {
                calculateInvoiceTotals();
            }
        });

        // –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
        function addLog(message) {
            const logsList = document.getElementById('logsList');
            const li = document.createElement('li');
            li.textContent = message;
            logsList.appendChild(li);
            logsList.scrollTop = logsList.scrollHeight;
        }

        function clearLogs() {
            if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏?')) {
                localStorage.removeItem('actionLogs');
                renderLogs();
            }
        }

        function exportLogsToExcel() {
            const logs = JSON.parse(localStorage.getItem('actionLogs') || '[]');
            
            if (logs.length === 0) {
                showAlert('–ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!', 'danger');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º CSV –∫–æ–Ω—Ç–µ–Ω—Ç
            let csvContent = '\uFEFF'; // BOM –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ Excel
            csvContent += '–í—Ä–µ–º—è,–î–µ–π—Å—Ç–≤–∏–µ\n';
            
            logs.forEach(log => {
                // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                const time = `"${log.time.replace(/"/g, '""')}"`;
                const action = `"${log.action.replace(/"/g, '""')}"`;
                csvContent += `${time},${action}\n`;
            });

            // –°–æ–∑–¥–∞–µ–º Blob —Å —Ç–∏–ø–æ–º –¥–ª—è Excel
            const blob = new Blob([csvContent], { 
                type: 'application/vnd.ms-excel;charset=utf-8;' 
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
            const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-'); // HH-MM-SS
            const filename = `logs_${dateStr}_${timeStr}.csv`;
            
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM, –∫–ª–∏–∫–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º URL
            URL.revokeObjectURL(url);
            
            addLog(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${logs.length} –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª ${filename}`);
            showAlert(`–õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª ${filename}!`, 'success');
        }

        function authenticate() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—Å–µ—Ö –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const isValidUser = (username === '—Ç–µ—Å—Ç' && password === '—Ç–µ—Å—Ç') || 
                               users.some(user => user.login === username && user.password === password);
            
            if (isValidUser) {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                addLog(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "${username}" –≤–æ—à—ë–ª –≤ —Å–∏—Å—Ç–µ–º—É`);
                document.getElementById('loginError').style.display = 'none';
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function openAddUserModal() {
            document.getElementById('addUserModal').style.display = 'block';
            document.getElementById('newUserLogin').value = '';
            document.getElementById('newUserPassword').value = '';
            document.getElementById('confirmUserPassword').value = '';
            document.getElementById('addUserError').style.display = 'none';
        }

        function closeAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        function addNewUser() {
            const login = document.getElementById('newUserLogin').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const confirmPassword = document.getElementById('confirmUserPassword').value.trim();
            const errorDiv = document.getElementById('addUserError');
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!login || !password || !confirmPassword) {
                errorDiv.textContent = '–í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (login.length < 3) {
                errorDiv.textContent = '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password.length < 3) {
                errorDiv.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password !== confirmPassword) {
                errorDiv.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                errorDiv.style.display = 'block';
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const users = JSON.parse(localStorage.getItem('systemUsers') || '[]');
            if (login === '—Ç–µ—Å—Ç' || users.some(user => user.login === login)) {
                errorDiv.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                errorDiv.style.display = 'block';
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            users.push({ login, password });
            localStorage.setItem('systemUsers', JSON.stringify(users));
            
            addLog(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${login}`);
            showAlert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
            closeAddUserModal();
        }

        function showClientHistory(clientName) {
            const clientInvoices = confirmedInvoices.filter(invoice => 
                invoice.client.name === clientName
            );

            document.getElementById('clientHistoryTitle').textContent = `–ò—Å—Ç–æ—Ä–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞: ${clientName}`;
            
            if (clientInvoices.length === 0) {
                document.getElementById('clientHistoryContent').innerHTML = 
                    '<p style="text-align: center; color: #666;">–£ –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∏–Ω–≤–æ–π—Å–æ–≤</p>';
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —á—Ç–æ –∏ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
                const tempContainer = document.createElement('div');
                tempContainer.id = 'tempClientInvoicesList';
                
                let listHTML = '';
                clientInvoices.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((invoice, index) => {
                    const date = new Date(invoice.date).toLocaleDateString('sr-RS');
                    const originalIndex = confirmedInvoices.findIndex(inv => inv.number === invoice.number);
                    const isDelivered = invoice.delivered || false;
                    const isPaid = invoice.paid || false;
                    
                    listHTML += `
                        <div class="invoice-item">
                            <div class="invoice-info">
                                <div style="font-weight: bold; color: #212529;">–ò–Ω–≤–æ–π—Å #${invoice.number}</div>
                                <div style="font-size: 14px; color: #666; margin-top: 5px;">${invoice.client.name} ‚Ä¢ ${date} ‚Ä¢ ${invoice.total.toFixed(2)} RSD</div>
                                <div style="font-size: 12px; color: #888; margin-top: 3px;">–¢–æ–≤–∞—Ä–æ–≤: ${invoice.items.length} ‚Ä¢ –ù–î–°: ${invoice.vatRate}%</div>
                                <div style="margin-top: 10px; display: flex; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                                        <input type="checkbox" ${isDelivered ? 'checked' : ''} onchange="toggleInvoiceStatus('${invoice.number}', 'delivered', this.checked)" style="transform: scale(1.2);">
                                        <span style="color: ${isDelivered ? '#28a745' : '#6c757d'};">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                                        <input type="checkbox" ${isPaid ? 'checked' : ''} onchange="toggleInvoiceStatus('${invoice.number}', 'paid', this.checked)" style="transform: scale(1.2);">
                                        <span style="color: ${isPaid ? '#28a745' : '#6c757d'};">–û–ø–ª–∞—á–µ–Ω</span>
                                    </label>
                                </div>
                            </div>
                            <div class="invoice-actions">
                                <button class="btn btn-secondary" onclick="viewConfirmedInvoice(${originalIndex})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω–≤–æ–π—Å">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                                <button class="btn btn-success" onclick="copyInvoiceData(${originalIndex})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—ã–π –∏–Ω–≤–æ–π—Å">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                                <span class="invoice-status">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('clientHistoryContent').innerHTML = listHTML;
            }
            
            document.getElementById('clientHistoryModal').style.display = 'block';
            addLog(`–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞: ${clientName}`);
        }

        function closeClientHistoryModal() {
            document.getElementById('clientHistoryModal').style.display = 'none';
        }

        function updateDeliveryClientFilter() {
            const filter = document.getElementById('deliveryClientFilter');
            if (!filter) return;
            
            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏, –∫—Ä–æ–º–µ "–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã"
            filter.innerHTML = '<option value="">–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</option>';
            
            // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü
            const uniqueClients = [...new Set(confirmedDeliveries.map(delivery => delivery.client.name))];
            
            uniqueClients.forEach(clientName => {
                const option = document.createElement('option');
                option.value = clientName;
                option.textContent = clientName;
                filter.appendChild(option);
            });
        }

        function filterDeliveriesByClient() {
            const selectedClient = document.getElementById('deliveryClientFilter').value;
            
            if (!selectedClient) {
                updateDeliveriesList();
                return;
            }
            
            const filteredDeliveries = confirmedDeliveries.filter(delivery => 
                delivery.client.name === selectedClient
            );
            
            updateDeliveriesList(filteredDeliveries);
        }

        function updateDeliveriesList(deliveries = confirmedDeliveries) {
            const container = document.getElementById('confirmedDeliveriesList');
            if (!container) return;

            if (deliveries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">–ù–µ—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü</p>';
                return;
            }

            let listHTML = '';
            deliveries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((delivery, index) => {
                const date = new Date(delivery.date).toLocaleDateString('sr-RS');
                const dueDate = new Date(delivery.dueDate).toLocaleDateString('sr-RS');
                const originalIndex = confirmedDeliveries.findIndex(del => del.number === delivery.number);
                const isSigned = delivery.signed || false;
                
                listHTML += `
                    <div class="invoice-item">
                        <div class="invoice-info">
                            <div style="font-weight: bold; color: #212529;">–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ #${delivery.number}</div>
                            <div style="font-size: 14px; color: #666; margin-top: 5px;">${delivery.client.name} ‚Ä¢ ${date} ‚Ä¢ –°—Ä–æ–∫: ${dueDate}</div>
                            <div style="font-size: 12px; color: #888; margin-top: 3px;">–¢–æ–≤–∞—Ä–æ–≤: ${delivery.items.length} ‚Ä¢ –°–ø–æ—Å–æ–±: ${delivery.method}</div>
                            <div style="margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 14px; cursor: pointer;">
                                    <input type="checkbox" ${isSigned ? 'checked' : ''} onchange="toggleDeliveryStatus('${delivery.number}', this.checked)" style="transform: scale(1.2);">
                                    <span style="color: ${isSigned ? '#28a745' : '#6c757d'};">–ü–æ–¥–ø–∏—Å–∞–Ω–∞</span>
                                </label>
                            </div>
                        </div>
                        <div class="invoice-actions">
                            <button class="btn btn-secondary" onclick="viewDelivery(${originalIndex})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                            <span class="invoice-status">–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</span>
                            <button class="btn btn-danger" onclick="removeDelivery('${delivery.number}')">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = listHTML;
        }

        function toggleDeliveryStatus(deliveryNumber, isChecked) {
            const delivery = confirmedDeliveries.find(del => del.number === deliveryNumber);
            if (delivery) {
                delivery.signed = isChecked;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                localStorage.setItem('confirmedDeliveries', JSON.stringify(confirmedDeliveries));
                
                addLog(`–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ #${deliveryNumber} –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ ${isChecked ? '–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è' : '–Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è'}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞
                filterDeliveriesByClient();
            }
        }

        function viewDelivery(deliveryIndex) {
            const delivery = confirmedDeliveries[deliveryIndex];
            if (!delivery) {
                showAlert('–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!', 'danger');
                return;
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            document.getElementById('deliveryNumber').value = delivery.number;
            document.getElementById('deliveryDate').value = delivery.date;
            document.getElementById('deliveryDueDate').value = delivery.dueDate;
            document.getElementById('deliveryMethod').value = delivery.method;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞
            const clientIndex = clients.findIndex(c => c.name === delivery.client.name);
            if (clientIndex !== -1) {
                document.getElementById('deliveryClient').value = clientIndex;
                document.getElementById('deliveryClientSearch').value = delivery.client.name;
            }
            
            showAlert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'success');
        }

        function removeDelivery(deliveryNumber) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–ø—Ä–µ–º–Ω–∏—Ü—É –∏–∑ —Å–ø–∏—Å–∫–∞?')) {
                confirmedDeliveries = confirmedDeliveries.filter(del => del.number !== deliveryNumber);
                localStorage.setItem('confirmedDeliveries', JSON.stringify(confirmedDeliveries));
                
                updateDeliveriesList();
                updateDeliveryClientFilter();
                
                addLog(`–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ #${deliveryNumber} —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞`);
                showAlert('–û—Ç–ø—Ä–µ–º–Ω–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞!', 'success');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
        window.onclick = function(event) {
            const addUserModal = document.getElementById('addUserModal');
            const clientHistoryModal = document.getElementById('clientHistoryModal');
            
            if (event.target === addUserModal) {
                closeAddUserModal();
            }
            if (event.target === clientHistoryModal) {
                closeClientHistoryModal();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
        }

        function addLog(action) {
            const logs = JSON.parse(localStorage.getItem('actionLogs') || '[]');
            const now = new Date();
            logs.unshift({
                time: now.toLocaleString(),
                action
            });
            localStorage.setItem('actionLogs', JSON.stringify(logs));
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('actionLogs') || '[]');
            const logsList = document.getElementById('logsList');
            if (!logsList) return;
            logsList.innerHTML = logs.length ? logs.map(log => `<li style='padding:10px 0; border-bottom:1px solid #dee2e6;'><b>${log.time}</b>: ${log.action}</li>`).join('') : '<li style="color:#888;">–ù–µ—Ç –ª–æ–≥–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π</li>';
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–ª–∏–∫–æ–≤
        document.addEventListener('click', function(event) {
            // –ù–µ –ª–æ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏ –ª–æ–≥–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è
            let el = event.target;
            let inLogsTab = false;
            while (el) {
                if (el.id === 'logs') { inLogsTab = true; break; }
                el = el.parentElement;
            }
            if (inLogsTab) return;

            let desc = '';
            if (event.target.closest('button')) {
                const btn = event.target.closest('button');
                desc = `–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ: "${btn.textContent.trim()}"`;
            } else if (event.target.closest('a')) {
                const a = event.target.closest('a');
                desc = `–ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ: "${a.textContent.trim()}" (${a.href})`;
            } else if (event.target.closest('input, select, textarea')) {
                const input = event.target.closest('input, select, textarea');
                desc = `–ö–ª–∏–∫ –ø–æ –ø–æ–ª—é: <${input.tagName.toLowerCase()}> (name/id: ${input.name || input.id})`;
            } else {
                desc = `–ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É: <${event.target.tagName.toLowerCase()}>`;
            }
            addLog(desc);
        }, true);
    </script>
</body>
</html>